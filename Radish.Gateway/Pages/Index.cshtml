@page "/server"
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@attribute [ApiExplorerSettings(IgnoreApi = true)]
@{
    Layout = null;
    ViewData["Title"] = "Radish æœåŠ¡é—¨æˆ·";

    var gatewayUrl = Configuration["GatewayService:PublicUrl"];
    var apiBaseUrl = Configuration["DownstreamServices:ApiService:BaseUrl"];
    var frontendBaseUrl = Configuration["FrontendService:BaseUrl"];
    var docsEnabled = bool.TryParse(Configuration["Docs:Enabled"], out var docsEnabledValue) && docsEnabledValue;
    var docsRequestPath = Configuration["Docs:RequestPath"] ?? "/docs/";
    var consoleRequestPath = "/console";
}

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/index.css" asp-append-version="true">
</head>
<body>
<main data-api-base-url="@apiBaseUrl"
      data-api-health-path="@(Configuration["DownstreamServices:ApiService:HealthCheckPath"] ?? "/health")"
      data-frontend-base-url="@frontendBaseUrl"
      data-docs-path="@docsRequestPath"
      data-console-path="@consoleRequestPath">
    <span class="badge">Radish Gateway Â· ASP.NET Core</span>
    <h1>æ¬¢è¿æ¥åˆ° Radish å¹³å°</h1>
    <p class="lead">
        è¿™é‡Œæ˜¯æœåŠ¡é—¨æˆ·å…¥å£ï¼Œä¸ºæ‚¨æä¾›ç»Ÿä¸€çš„æœåŠ¡è®¿é—®ã€å¥åº·æ£€æŸ¥å’Œå¼€å‘æ–‡æ¡£ã€‚ä½¿ç”¨ä¸‹æ–¹å¿«æ·å…¥å£å³å¯æŸ¥é˜…é¡¹ç›®æ–‡æ¡£ã€API å¯è§†åŒ–ä¸æœåŠ¡çŠ¶æ€ã€‚
    </p>

    <section class="services-info">
        <h2>ğŸŒ æœåŠ¡åœ°å€</h2>
        <div class="service-grid">
            <div class="service-card gateway">
                <div class="service-icon">ğŸšª</div>
                <div class="service-details">
                    <h3>Gateway ç½‘å…³</h3>
                    <div class="service-urls">
                        <a href="@gatewayUrl" target="_blank">@gatewayUrl</a>
                    </div>
                </div>
            </div>

            <div class="service-card frontend">
                <div class="service-icon">âš›ï¸</div>
                <div class="service-details">
                    <h3>React å‰ç«¯</h3>
                    <div class="service-urls">
                        <a href="@frontendBaseUrl" target="_blank">@frontendBaseUrl</a>
                    </div>
                </div>
            </div>

            <div class="service-card api">
                <div class="service-icon">ğŸ”Œ</div>
                <div class="service-details">
                    <h3>API æœåŠ¡</h3>
                    <div class="service-urls">
                        <a href="@($"{apiBaseUrl}/api/docs")" target="_blank">@apiBaseUrl</a>
                    </div>
                </div>
            </div>

            <div class="service-card docs">
                <div class="service-icon">ğŸ“š</div>
                <div class="service-details">
                    <h3>Docs æ–‡æ¡£ç«™</h3>
                    <div class="service-urls">
                        <a href="@docsRequestPath" target="_blank">@($"{gatewayUrl}{docsRequestPath}")</a>
                    </div>
                </div>
            </div>

            <div class="service-card console">
                <div class="service-icon">ğŸ–¥ï¸</div>
                <div class="service-details">
                    <h3>æœåŠ¡æ§åˆ¶å°</h3>
                    <div class="service-urls">
                        <a href="@consoleRequestPath" target="_blank">@($"{gatewayUrl}{consoleRequestPath}")</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="actions">
        @if (docsEnabled)
        {
            <a class="button primary" href="@docsRequestPath" target="_blank" rel="noopener noreferrer">æ‰“å¼€é¡¹ç›®æ–‡æ¡£</a>
        }
        <a class="button secondary" href="@($"{apiBaseUrl}/api/docs")" target="_blank" rel="noopener noreferrer">API Scalar å¯è§†åŒ–</a>
        <a class="button secondary" href="@frontendBaseUrl" target="_blank" rel="noopener noreferrer">è®¿é—®å‰ç«¯åº”ç”¨</a>
        <a class="button secondary" href="@consoleRequestPath" target="_blank" rel="noopener noreferrer">æœåŠ¡æ§åˆ¶å° Console</a>
    </div>

    <section class="grid">
        <article>
            <h2>Gateway çŠ¶æ€</h2>
            <p id="health-status" class="status-text">æ­£åœ¨æ£€æµ‹ Gateway å¥åº·çŠ¶å†µ...</p>
            <small style="color: var(--muted);">æ£€æŸ¥ Gateway è‡ªèº«çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ã€‚</small>
        </article>

        <article>
            <h2>ä¸‹æ¸¸æœåŠ¡</h2>
            <p id="downstream-status" class="status-text">æ­£åœ¨æ£€æµ‹ API æœåŠ¡çŠ¶å†µ...</p>
            <small style="color: var(--muted);">ç›‘æ§ä¸‹æ¸¸ API æœåŠ¡çš„å¯ç”¨æ€§ã€‚</small>
        </article>
    </section>

    <section class="grid" style="margin-top: 1.5rem;">
        <article>
            <h2>å‰ç«¯åº”ç”¨</h2>
            <p id="frontend-status" class="status-text">æ­£åœ¨æ£€æµ‹å‰ç«¯åº”ç”¨çŠ¶å†µ...</p>
            <small style="color: var(--muted);">æ£€æŸ¥ WebOS å‰ç«¯æœåŠ¡æ˜¯å¦å¯ä»¥è®¿é—®ã€‚</small>
        </article>

        <article>
            <h2>Docs ä¸ Console</h2>
            <p id="docs-status" class="status-text">æ­£åœ¨æ£€æµ‹ Docs æ–‡æ¡£ç«™çŠ¶å†µ...</p>
            <p id="console-status" class="status-text">æ­£åœ¨æ£€æµ‹ Console æ§åˆ¶å°çŠ¶å†µ...</p>
            <small style="color: var(--muted);">ç›‘æ§æ–‡æ¡£ç«™ä¸æ§åˆ¶å°æœåŠ¡çš„å¯ç”¨æ€§ã€‚</small>
        </article>
    </section>

    <section class="grid" style="margin-top: 1.5rem;">
        <article>
            <h2>å¿«é€Ÿå¼€å§‹ - Gateway</h2>
            <ol>
                <li><code>dotnet build Radish.slnx -c Debug</code></li>
                <li><code>dotnet run --project Radish.Gateway/Radish.Gateway.csproj</code></li>
                <li>æµè§ˆå™¨è®¿é—® <code id="current-origin">/</code></li>
            </ol>
        </article>

        <article>
            <h2>å¿«é€Ÿå¼€å§‹ - API</h2>
            <ol>
                <li><code>dotnet restore && dotnet build Radish.slnx -c Debug</code></li>
                <li><code>dotnet run --project Radish.Api/Radish.Api.csproj</code></li>
                <li>æµè§ˆå™¨è®¿é—® <code>@($"{apiBaseUrl}/api/docs")</code></li>
            </ol>
        </article>
    </section>

    <article style="margin-top: 1.5rem;">
        <h2>å¸¸ç”¨èµ„æº</h2>
        <ul class="resource-list">
            <li>
                <strong>docs/</strong>
                <span>æŸ¥çœ‹é¡¹ç›®çº¦å®šã€æŠ€æœ¯æ ˆä¸è¿›å±•è®°å½•ã€‚</span>
            </li>
            <li>
                <strong>Radish.Api.http</strong>
                <span>ä½¿ç”¨ VS / Rider / HTTP Client å¿«é€ŸéªŒè¯æ¥å£ã€‚</span>
            </li>
            <li>
                <strong>radish.client</strong>
                <span>Vite å‰ç«¯ï¼Œè¿è¡Œ <code>npm install && npm run dev --prefix radish.client</code>ã€‚</span>
            </li>
            <li>
                <strong>local-start.ps1 / local-start.sh</strong>
                <span>äº¤äº’å¼èœå•å¿«é€Ÿå¯åŠ¨å‰ç«¯ã€åç«¯ã€Gateway æˆ–è¿è¡Œæµ‹è¯•ã€‚</span>
            </li>
        </ul>
    </article>

    <footer>Radish Platform Â· æ„å»ºå¿«é€Ÿã€å®‰å…¨çš„åå°æœåŠ¡ä½“éªŒ</footer>
</main>

<script src="~/js/index.js" asp-append-version="true"></script>
</body>
</html>
