{
  // ============================================================
  // Radish.Auth - OIDC 认证服务器配置模板
  // ============================================================
  // 说明：本配置文件包含所有可用配置项及其默认值
  //       开发/部署时，请复制本文件为 appsettings.Local.json
  //       然后修改其中的敏感信息（数据库密码、Redis密码、OpenIddict密钥等）
  // 注意：appsettings.Local.json 已在 .gitignore 中排除，不会提交到仓库
  // ============================================================

  // 日志配置
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "OpenIddict": "Information"
    }
  },

  // Serilog 日志配置
  "Serilog": {
    // 最小日志级别: Verbose, Debug, Information, Warning, Error, Fatal
    "MinimumLevel": "Information",

    // 控制台输出配置
    "Console": {
      "Enable": true,                    // 是否启用控制台输出
      "EnableApplicationLog": true,      // 是否输出应用日志
      "EnableSqlLog": true               // 是否输出 SQL 日志
    },

    // 文件输出配置
    "File": {
      "Enable": true,                    // 是否启用文件输出
      "EnableApplicationLog": true,      // 是否输出应用日志到文件
      "EnableSqlLog": true,              // 是否输出 SQL 日志到文件
      "RetainedFileCountLimit": 31       // 文件保留天数
    },

    // 数据库输出配置
    "Database": {
      "Enable": false,                   // 是否启用数据库输出(默认关闭，可在 Local.json 中启用)
      "EnableApplicationLog": true,      // 是否记录应用日志到数据库
      "EnableSqlLog": true,              // 是否记录 SQL 日志到数据库
      "LogSelectQueries": true,          // 是否记录 SELECT 查询(false 时仅记录 INSERT/UPDATE/DELETE)
      "BatchSizeLimit": 500,             // 批处理大小限制
      "PeriodSeconds": 1,                // 批处理周期(秒)
      "EagerlyEmitFirstEvent": true,     // 是否立即发送第一个事件
      "QueueLimit": 10000                // 队列限制
    }
  },

  // 允许的入口地址
  "AllowedHosts": "*",

  // CORS 配置（跨域资源共享）
  // 开发环境：添加前端、API、Gateway 地址
  // 生产环境：配置实际的域名
  "Cors": {
    "AllowedOrigins": [
      "https://localhost:5000",
      "http://localhost:5001"
    ]
  },

  // AutoMapper 配置
  // 如有商业许可证，请在 appsettings.Local.json 中配置
  "AutoMapper": {
    "LicenseKey": ""
  },

  // SqlSugar 的雪花 ID 算法配置
  // WorkId 必须在同一部署环境中唯一（范围 0-30）
  // 约定：API=0, Gateway=1, Auth=2
  "Snowflake": {
    "WorkId": 2,
    // 数据中心 ID，默认为 0 即可
    "DataCenterId": 0
  },

  // Redis 配置
  // Enable: true=使用 Redis，false=使用内存缓存
  // 本地开发建议使用 false（内存缓存），生产环境建议使用 Redis
  "Redis": {
    "Enable": false,
    "ConnectionString": "localhost:6379,allowAdmin=true",
    "InstanceName": "RadishAuth"
  },

  // 速率限制配置
  // 保护认证服务器免受暴力破解和 DDoS 攻击
  "RateLimit": {
    // 是否启用速率限制
    "Enable": true,
    // 是否记录限流日志
    "EnableLogging": true,

    // 全局限流（Fixed Window 算法）
    // 适用于所有端点的基础限流
    "Global": {
      "Enable": true,
      "PermitLimit": 200, // 每个 IP 每分钟最多 200 个请求
      "WindowSeconds": 60 // 时间窗口：60 秒
    },

    // 登录限流（Sliding Window 算法）
    // 防止暴力破解登录
    "Login": {
      "Enable": true,
      "PermitLimit": 10, // 每个 IP 15 分钟最多 10 次登录尝试
      "WindowSeconds": 900, // 时间窗口：900 秒（15 分钟）
      "SegmentsPerWindow": 8 // 滑动窗口分段数
    },

    // 敏感操作限流（Token Bucket 算法）
    // 适用于 token 端点等敏感操作
    "Sensitive": {
      "Enable": true,
      "TokenLimit": 20, // 令牌桶容量
      "TokensPerPeriod": 20, // 每个周期补充的令牌数
      "ReplenishmentPeriodSeconds": 60, // 补充周期：60 秒
      "QueueLimit": 0 // 队列限制（0 表示不排队，直接拒绝）
    },

    // 并发限流（Concurrency Limiter）
    // 限制同时处理的请求数
    "Concurrency": {
      "Enable": true,
      "PermitLimit": 100, // 每个 IP 最多 100 个并发请求
      "QueueLimit": 50 // 队列限制：最多排队 50 个请求
    },

    // IP 黑名单配置
    // 自动或手动封禁恶意 IP
    "Blacklist": {
      "Enable": false, // 默认禁用，需要时在 appsettings.Local.json 中启用
      "IpAddresses": [], // 黑名单 IP 列表（支持 CIDR 格式，如 "192.168.1.0/24"）
      "AutoBlockAfterRejections": 0, // 触发限流多少次后自动加入黑名单（0 表示不自动加入）
      "AutoBlockDurationSeconds": 3600 // 自动封禁时长（秒，0 表示永久）
    },

    // IP 白名单配置
    // 白名单中的 IP 不受限流限制
    "Whitelist": {
      "Enable": false, // 默认禁用，需要时在 appsettings.Local.json 中启用
      "IpAddresses": [] // 白名单 IP 列表（支持 CIDR 格式，如 "10.0.0.0/8"）
    }
  },
  // Redis 远程服务器示例（生产环境）
  // "Redis": {
  //   "Enable": true,
  //   "ConnectionString": "your-redis-server.com:6379,password=your_redis_password,allowAdmin=true,ssl=true",
  //   "InstanceName": "RadishAuth"
  // },

  // 数据库配置
  // MainDb: 标识当前项目的主库
  // Log: 日志库（固定名称，不要修改）
  // Message: 消息数据库（通知系统专用，与 API 共享）
  // 默认使用 SQLite（适合本地开发和快速启动）
  "MainDb": "Main",
  "Databases": [
    /**
     * DbType 类型对照表：
     * MySql = 0,
     * SqlServer = 1,
     * Sqlite = 2,
     * Oracle = 3,
     * PostgreSql = 4,
     * DaMeng = 5, // 达梦
     * Kdbndp = 6, // 金仓
     */
    {
      "ConnId": "Main",
      "DbType": 2, // SQLite
      "Enabled": true,
      // SQLite 只需数据库名，文件将自动在项目根目录创建
      "ConnectionString": "Radish.db" // 主库，要和 API 项目保持一致
    },
    {
      "ConnId": "Log", // 日志库（固定名称，不要修改）
      "DbType": 2, // SQLite
      "Enabled": true,
      "HitRate": 50,
      "ConnectionString": "Radish.Log.db" // 主日志库，要和 API 项目保持一致
    },
    {
      "ConnId": "Message", // 消息数据库（通知系统专用，与 API 共享）
      "DbType": 2, // SQLite
      "Enabled": true,
      "HitRate": 50,
      "ConnectionString": "Radish.Message.db"
    }
  ],
  // PostgreSQL 配置示例（生产环境推荐）
  // 使用时将上面的 Databases 配置替换为以下内容：
  // "Databases": [
  //   {
  //     "ConnId": "Main",
  //     "DbType": 4, // PostgreSQL
  //     "Enabled": true,
  //     "ConnectionString": "Host=localhost;Port=5432;Database=radish_auth;Username=postgres;Password=your_password_here"
  //   },
  //   {
  //     "ConnId": "Log",
  //     "DbType": 4, // PostgreSQL
  //     "Enabled": true,
  //     "HitRate": 50,
  //     "ConnectionString": "Host=localhost;Port=5432;Database=radish_auth_log;Username=postgres;Password=your_password_here"
  //   },
  //   {
  //     "ConnId": "Message",
  //     "DbType": 4, // PostgreSQL
  //     "Enabled": true,
  //     "HitRate": 50,
  //     "ConnectionString": "Host=localhost;Port=5432;Database=radish_message;Username=postgres;Password=your_password_here"
  //   }
  // ],

  // OpenIddict 数据库连接字符串（可选）
  // 默认情况下，OpenIddict 数据库会自动创建在解决方案根目录的 DataBases 文件夹：
  // DataBases/Radish.OpenIddict.db
  // 如果需要自定义数据库路径或使用其他数据库，可以在 appsettings.Local.json 中配置：
  // "ConnectionStrings": {
  //   "OpenIddict": "Data Source=/custom/path/Radish.OpenIddict.db"
  // }
  // 或使用 PostgreSQL：
  // "ConnectionStrings": {
  //   "OpenIddict": "Host=localhost;Port=5432;Database=radish_openiddict;Username=postgres;Password=your_password_here"
  // }

  // OpenIddict 配置
  "OpenIddict": {
    // 服务器配置
    "Server": {
      // 发行者 URL（认证服务器地址）
      // 本地开发：http://localhost:5200（直接访问）或 https://localhost:5000（通过 Gateway）
      // 生产环境：https://your-domain.com（通过 Gateway）
      "Issuer": "https://localhost:5000",

      // 令牌有效期（分钟）
      "AccessTokenLifetime": 60, // 访问令牌：60分钟
      "RefreshTokenLifetime": 43200, // 刷新令牌：30天
      "AuthorizationCodeLifetime": 5, // 授权码：5分钟

      // 是否允许不安全的 HTTP（仅开发环境使用）
      // 生产环境必须设置为 false，使用 HTTPS
      "AllowInsecureHttp": false
    },

    // 加密配置
    "Encryption": {
      // 统一使用仓库中的 Certs/dev-auth-cert.pfx 作为开发证书
      // 生产环境必须重新生成证书并修改密码
      "UseDevelopmentKeys": false,
      "SigningCertificatePath": "../Certs/dev-auth-cert.pfx",
      "SigningCertificatePassword": "RadishDevCert123!",
      "EncryptionCertificatePath": "../Certs/dev-auth-cert.pfx",
      "EncryptionCertificatePassword": "RadishDevCert123!"
    }
  }
  // OpenIddict 生产环境配置示例：
  // "OpenIddict": {
  //   "Server": {
  //     "Issuer": "https://your-domain.com",
  //     "AccessTokenLifetime": 60,
  //     "RefreshTokenLifetime": 43200,
  //     "AuthorizationCodeLifetime": 5,
  //     "AllowInsecureHttp": false
  //   },
  //   "Encryption": {
  //     "UseDevelopmentKeys": false,
  //     "SigningCertificatePath": "/app/certs/auth-signing.pfx",
  //     "SigningCertificatePassword": "your-prod-password",
  //     "EncryptionCertificatePath": "/app/certs/auth-encryption.pfx",
  //     "EncryptionCertificatePassword": "your-prod-password"
  //   }
  // }
}
