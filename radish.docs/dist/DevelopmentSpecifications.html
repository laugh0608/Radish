<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发规范 | Radish 文档</title>
    <meta name="description" content="Radish 社区平台文档">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/docs/assets/style.DuOwLuGy.css" as="style">
    <link rel="preload stylesheet" href="/docs/vp-icons.css" as="style">
    
    <script type="module" src="/docs/assets/app.DrLBQsnq.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.DXkXcpDi.js">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.DdJmP4Xu.js">
    <link rel="modulepreload" href="/docs/assets/DevelopmentSpecifications.md.DtLMyQ61.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/docs/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Radish 文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/docs/DevelopmentSpecifications.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>开发文档</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/DevelopmentFramework.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>架构设计</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/DeploymentGuide.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>部署运维</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>快速开始</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>项目概览</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>开发指南</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentSpecifications.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentFramework.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发框架说明</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/AuthenticationGuide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>认证与权限</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/FrontendDesign.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>前端设计</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/GatewayPlan.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Gateway 规划</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>部署与运维</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DeploymentGuide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>部署指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentPlan.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发计划</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentLog.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发日志</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _docs_DevelopmentSpecifications" data-v-39a288b8><div><h1 id="开发规范" tabindex="-1">开发规范 <a class="header-anchor" href="#开发规范" aria-label="Permalink to &quot;开发规范&quot;">​</a></h1><ul><li>养成一个好习惯，先写接口（IService），再写实现（Service）</li><li>BaseRepository、BaseService、IBaseRepository、IBaseService 都已定义，后续增加业务只需要定义 Model 和 ViewModel 即可</li></ul><h2 id="项目版本号规范" tabindex="-1">项目版本号规范 <a class="header-anchor" href="#项目版本号规范" aria-label="Permalink to &quot;项目版本号规范&quot;">​</a></h2><p>Radish 项目采用**语义化版本号（Semantic Versioning）**规范，确保版本号能够清晰传达变更的性质和影响范围。</p><h3 id="版本号格式" tabindex="-1">版本号格式 <a class="header-anchor" href="#版本号格式" aria-label="Permalink to &quot;版本号格式&quot;">​</a></h3><p>标准版本号格式为：<code>vMAJOR.MINOR.PATCH</code></p><ul><li><p><strong>MAJOR（主版本号）</strong>：重大功能变更或不兼容的 API 修改</p><ul><li>包含架构重构、核心功能调整、破坏性变更</li><li>可能导致现有客户端或集成系统需要适配</li><li>示例：v1.0.0 → v2.0.0</li></ul></li><li><p><strong>MINOR（次版本号）</strong>：向后兼容的功能新增</p><ul><li>添加新的接口、新的功能模块</li><li>增强现有功能但不破坏兼容性</li><li>示例：v1.0.0 → v1.1.0</li></ul></li><li><p><strong>PATCH（修订版本号）</strong>：向后兼容的问题修复</p><ul><li>Bug 修复、性能优化、文档更新</li><li>不改变 API 接口和功能行为</li><li>示例：v1.1.0 → v1.1.1</li></ul></li></ul><h3 id="版本号示例" tabindex="-1">版本号示例 <a class="header-anchor" href="#版本号示例" aria-label="Permalink to &quot;版本号示例&quot;">​</a></h3><p><strong>典型发布流程：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>v0.1.0 - 项目初始版本（开发阶段）</span></span>
<span class="line"><span>v0.2.0 - 添加用户认证功能</span></span>
<span class="line"><span>v0.3.0 - 添加多租户支持</span></span>
<span class="line"><span>v1.0.0 - 首个正式发布版本（生产就绪）</span></span>
<span class="line"><span>v1.1.0 - 添加 SignalR 实时通信功能</span></span>
<span class="line"><span>v1.1.1 - 修复登录超时 Bug</span></span>
<span class="line"><span>v1.2.0 - 添加 Rust 原生扩展支持</span></span>
<span class="line"><span>v2.0.0 - 架构重构，迁移至 .NET 10</span></span></code></pre></div><h3 id="特殊版本格式" tabindex="-1">特殊版本格式 <a class="header-anchor" href="#特殊版本格式" aria-label="Permalink to &quot;特殊版本格式&quot;">​</a></h3><p><strong>热更新/阶段性版本：</strong></p><p>对于当日发布的热更新、紧急修复或阶段性 PR 合并，可使用扩展格式：<code>vMAJOR.MINOR.PATCH.YYMMDD</code></p><ul><li><strong>YYMMDD</strong>：两位年份 + 两位月份 + 两位日期</li><li>示例： <ul><li><code>v0.1.0.251126</code> - 2025年11月26日的开发阶段热更新</li><li><code>v1.2.3.251201</code> - v1.2.3 版本在2025年12月1日的紧急修复</li><li><code>v2.0.0.260115</code> - v2.0.0 版本在2026年1月15日的阶段性合并</li></ul></li></ul><p><strong>使用场景：</strong></p><ul><li>当日多次部署需要区分构建版本</li><li>开发/测试环境的频繁更新</li><li>分支合并前的阶段性验证</li><li>热修复快速迭代</li></ul><p><strong>注意事项：</strong></p><ul><li>日期后缀不计入语义化版本的比较规则</li><li>正式发布时应去掉日期后缀，只保留三段式版本号</li><li>生产环境部署优先使用标准三段式版本号</li></ul><h3 id="版本号使用规范" tabindex="-1">版本号使用规范 <a class="header-anchor" href="#版本号使用规范" aria-label="Permalink to &quot;版本号使用规范&quot;">​</a></h3><p><strong>Git 标签：</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建版本标签</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.2.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Release version 1.2.0: Add SignalR support&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.2.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建热更新标签</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.2.0.251126</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hotfix: Fix critical login bug&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.2.0.251126</span></span></code></pre></div><p><strong>发布说明：</strong></p><ul><li>每个版本发布必须在 GitHub Release 中创建对应条目</li><li>Release Notes 应包含： <ul><li><strong>新增功能</strong>（Features）</li><li><strong>Bug 修复</strong>（Bug Fixes）</li><li><strong>性能优化</strong>（Performance）</li><li><strong>破坏性变更</strong>（Breaking Changes）</li><li><strong>依赖更新</strong>（Dependencies）</li></ul></li></ul><p><strong>配置文件：</strong></p><ul><li>前端版本号：<code>radish.client/package.json</code> 中的 <code>version</code> 字段</li><li>后端版本号：<code>Radish.Api/Radish.Api.csproj</code> 中的 <code>&lt;Version&gt;</code> 标签</li><li>保持前后端版本号同步更新</li></ul><p><strong>版本兼容性：</strong></p><ul><li>v0.x.x：开发阶段，API 可能频繁变更，不保证兼容性</li><li>v1.x.x：首个稳定版本，MINOR 和 PATCH 更新保持向后兼容</li><li>v2.x.x+：重大版本更新，需提供迁移指南和兼容性说明</li></ul><h3 id="版本发布流程" tabindex="-1">版本发布流程 <a class="header-anchor" href="#版本发布流程" aria-label="Permalink to &quot;版本发布流程&quot;">​</a></h3><ol><li><strong>版本规划</strong>：在开发开始前确定目标版本号</li><li><strong>代码冻结</strong>：完成所有计划功能后冻结新增代码</li><li><strong>测试验证</strong>：完整的功能测试、性能测试、安全测试</li><li><strong>版本号更新</strong>：统一更新前后端版本号</li><li><strong>Git 标签</strong>：创建版本标签并推送到远程仓库</li><li><strong>Release Notes</strong>：编写详细的发布说明</li><li><strong>部署发布</strong>：按照 <a href="./DeploymentGuide.html">DeploymentGuide.md</a> 进行部署</li></ol><h3 id="与-api-版本控制的关系" tabindex="-1">与 API 版本控制的关系 <a class="header-anchor" href="#与-api-版本控制的关系" aria-label="Permalink to &quot;与 API 版本控制的关系&quot;">​</a></h3><ul><li><strong>项目版本号</strong>（本节规范）：指整个 Radish 项目的发布版本，用于标识软件的迭代状态</li><li><strong>API 版本控制</strong>（见 &quot;API 版本控制规范&quot; 章节）：指 HTTP API 的接口版本，用于管理 API 的向后兼容性</li></ul><p>两者独立管理：</p><ul><li>项目版本 v1.2.3 可能同时包含 API v1 和 API v2</li><li>API 版本更新不一定触发项目主版本号变更</li><li>项目重大版本更新（如 v2.0.0）通常伴随 API 版本升级</li></ul><h2 id="项目结构约定" tabindex="-1">项目结构约定 <a class="header-anchor" href="#项目结构约定" aria-label="Permalink to &quot;项目结构约定&quot;">​</a></h2><ul><li>docs/：项目文档，实际文件夹，映射解决方案中的 docs 目录，包含开发规范、设计文档等</li><li>others/：其他资源文件，虚拟文件夹，只是解决方案中的文件夹，其中所有文件均为项目根目录下的，包括 Dockerfile、GitHub 配置、start.ps1 脚本 等</li><li>radish.client：主要 - 前端 React 应用代码，TypeScript 编写</li><li>Radish.Gateway：主要 - 服务门户与网关项目，ASP.NET Core 编写；Phase 0 阶段承载服务欢迎页面、健康检查展示、API 文档入口等功能；后续阶段（P1+）将实现 API 路由转发、统一认证、聚合接口等 Gateway 功能。详细规划见 <code>docs/GatewayPlan.md</code>。</li><li>Radish.Api：主要 - 后端服务代码，ASP.NET Core 编写；专注于提供 REST API 接口，不包含页面展示功能</li><li>Radish.Common：后端服务使用的普通工具类，例如基础日志、基础配置等；<strong>仅能引用外部 NuGet 包，不允许依赖任何内部业务层</strong>。若某工具/扩展需要访问 <code>Radish.Model</code>、Service 或 Repository 中的类型（如 DTO、实体、仓储服务等），应放置在 <code>Radish.Extension</code> 中，以免 Common 层被反向依赖导致环状引用。</li><li>Radish.Core：后端核心业务逻辑与算法类，保留模块，为后续流程模拟与算法实现做准备</li><li>Radish.Extension：后端扩展功能模块类，例如 Swagger/Scalar、HealthCheck 等</li><li>Radish.Infrastructure：数据库与多租户基础设施层，集中维护 SqlSugar 扩展、租户过滤、表/库路由与连接解析逻辑，供 Extension、Repository 等项目复用</li><li>Radish.IRepository：后端数据访问接口类，定义数据访问层接口</li><li>Radish.IService：后端服务接口类，定义业务逻辑层接口</li><li>Radish.Model：后端数据模型类，仅存放数据库实体；实体（Entity）只能在 Repository 层内被直接操作，Service 层及以上均需转换为视图模型或 DTO</li><li>Radish.Model.LogModels：用于承载日志库实体，<code>BaseLog</code> 统一 DateTime/Level/Message 等字段，<code>AuditSqlLog</code> 通过 <code>[Tenant(configId: &quot;log&quot;)] + [SplitTable(SplitType.Month)]</code> 按月写入日志；对应的 <code>AuditSqlLogVo</code> 仍位于 <code>ViewModels</code>，对外访问必须走 Vo/DTO</li><li>Radish.Repository：后端数据访问实现类，具体实现数据访问接口</li><li>Radish.Service：后端服务实现类，具体实现业务逻辑接口</li><li>Radish.Shared：前后端共享的模型和工具类，例如 DTO、枚举等</li><li>Radish.Api.Tests：xUnit 测试工程，目前包含 UserController 示例测试，约束接口返回示例数据</li><li>native/rust（规划目录）：承载 Rust 扩展库或性能模块源码与 <code>cargo</code> 构建脚本，位于解决方案根目录；当前 <code>Radish.Core/test_lib</code> 只是互操作示例，正式原生模块应迁移到该目录并作为 Solution Folder 挂载。</li></ul><h2 id="分层依赖约定" tabindex="-1">分层依赖约定 <a class="header-anchor" href="#分层依赖约定" aria-label="Permalink to &quot;分层依赖约定&quot;">​</a></h2><ul><li>前端项目（radish.client）仅依赖 npm 包</li><li>Gateway 项目（Radish.Gateway）： <ul><li>Phase 0 阶段：依赖 <code>Radish.Common</code>（配置工具）和 <code>Radish.Extension</code>（日志扩展），提供 Razor Pages 页面展示和静态文件服务</li><li>P1+ 阶段：额外引入 <code>Ocelot</code> 或 <code>YARP</code> 实现路由转发，可能需要引用 <code>Radish.Service</code> 实现聚合接口和统一认证</li><li>职责：服务门户展示、健康检查聚合、API 路由转发（P1+）、统一认证（P2+）、请求聚合（P3+）</li></ul></li><li>后端项目按层次结构依赖： <ul><li>Radish.Api 引用 radish.client（用于 SPA 代理）与 Radish.Service，并通过 Program.cs 注入 <code>IUserService/IUserRepository</code> 等接口实现；同时依赖 Radish.Common 以注册 <code>AppSettings</code> 扩展，避免在其他层重复创建配置源。</li><li>Radish.Service 依赖 Radish.IService（接口契约）与 Radish.Repository（数据访问实现），负责聚合业务逻辑；Service 层对外仅暴露 DTO/Vo，必须在返回前将仓储层实体映射为视图模型（推荐 AutoMapper）。</li><li>Radish.Repository 依赖 Radish.IRepository、Radish.Model 以及 Radish.Infrastructure 中的 SqlSugar/租户扩展，只能向 Service 层返回实体或实体集合，禁止直接引用任何 Vo/DTO；接口层 Radish.IRepository 与 Radish.IService 统一依赖 Radish.Model，以便共享实体与视图模型定义。</li></ul></li><li>Radish.Extension 仅由宿主（Radish.Api、Radish.Gateway）引用，用于集中管理 Autofac/AutoMapper/配置扩展；该项目可以引用 Service/Repository 以及 Infrastructure 以注册实现，但 Service/Repository 项目禁止反向依赖。凡是需要宿主信息的模块（如 Controller 程序集、配置源等）必须通过构造函数参数由宿主传入，例如 <code>new AutofacPropertyModuleReg(typeof(Program).Assembly)</code>，避免因为直接引用 <code>Program</code> 造成循环依赖。 <ul><li>Radish.Core 暂时保留，无直接依赖关系</li></ul></li><li><code>UserController -&gt; IUserService -&gt; IUserRepository</code> 构成的示例链路是官方范例，任何新功能应当沿用&quot;Controller 调用 Service，再由 Service 访问 Repository&quot;的模式，并补齐对应接口定义</li></ul><h2 id="数据库与-sqlsugar-配置" tabindex="-1">数据库与 SqlSugar 配置 <a class="header-anchor" href="#数据库与-sqlsugar-配置" aria-label="Permalink to &quot;数据库与 SqlSugar 配置&quot;">​</a></h2><ul><li><code>Program.cs</code> 需要在 <code>builder.Build()</code> 前调用 <code>builder.Services.AddSqlSugarSetup()</code>。该扩展定义于 <code>Radish.Extension.SqlSugarExtension</code>，内部依赖 <code>Radish.Infrastructure.Tenant.RepositorySetting</code>、<code>TenantUtil</code> 等组件，使用 <code>SqlSugarScope</code> 单例注入并绑定所有连接配置。</li><li><code>appsettings.json</code> 约定结构如下：</li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;MainDb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;Databases&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;ConnId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;DbType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;Enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;ConnectionString&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Radish.db&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;ConnId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;DbType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;Enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;ConnectionString&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;RadishLog.db&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;HitRate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><code>MainDb</code> 指定默认主库的 <code>ConnId</code>；当配置多库/主从时，<code>BaseDbConfig.MutiConnectionString</code> 会把该连接放在集合首位。</li><li><code>Databases</code> 中至少包含 <code>ConnId=Main</code> 与 <code>ConnId=Log</code> 两条记录，后者名称固定（<code>SqlSugarConst.LogConfigId</code>），缺失时启动会抛出异常；其余库可自定义 <code>DbType</code> 与从库 <code>Slaves</code> 列表。</li><li><code>Snowflake</code> 段存放雪花 ID 的 <code>WorkId</code> 与 <code>DataCenterId</code>，本地/测试/生产必须配置为互不相同的整数（0~30），避免多节点冲突；<code>appsettings.json</code> 只保存兜底值，实际部署请在 <code>appsettings.{Environment}.json</code>（如 Development/Production）中覆盖，以便按服务器或容器分配固定编号。</li><li>Program 在调用 <code>builder.Services.AddSqlSugarSetup()</code> 后会立即读取 <code>Snowflake</code> 段并设置 <code>SnowFlakeSingle.WorkId/DatacenterId</code>，因此只要在环境配置中写好差异值即可，无需在扩展或仓储层重复配置；若服务器时间曾被回拨，务必同步调整新的 WorkId。</li><li><code>BaseRepository</code> 通过 <code>IUnitOfWorkManage</code> 获取 <code>SqlSugarScope</code> 单例，内部根据泛型实体的 <code>[Tenant(configId)]</code> 特性切换连接；未标注特性的实体沿用 <code>MainDb</code>，标注了 <code>configId=&quot;Log&quot;</code> 等值（大小写不敏感）的实体会自动访问对应库。需要写入日志库或其他独立库的模型务必显式添加 <code>TenantAttribute</code>，以免错写入主库；若实体启用了 <code>[MultiTenant(TenantTypeEnum.DataBases)]</code>，<code>BaseRepository</code> 会通过 <code>TenantUtil.GetConnectionConfig()</code> 在运行期动态添加租户库配置。</li><li>使用 SQLite 时 <code>ConnectionString</code> 只需传数据库文件名，运行期会自动拼接 <code>Environment.CurrentDirectory</code>；对于 MySQL/SQLServer 等外部数据库，可通过 <code>dbCountPsw1_*.txt</code> 本地文件或环境变量隐藏真实连接串，<code>BaseDbConfig.SpecialDbString</code> 会优先读取文件值。</li><li>SQL 日志统一通过 <code>SqlSugarAop.OnLogExecuting</code> 写入 Serilog，<code>LogContextTool</code> 会在上下文中打上 <code>LogSource=AopSql</code> 标签；SqlSugar 的缓存实现委托给 <code>Radish.Common.CacheTool.SqlSugarCache</code>，保持与 Redis/内存缓存一致的策略。Serilog 输出由 <code>SerilogSetup + LogConfigExtension</code> 统一配置，普通日志与 SQL 日志会分别落入 <code>Log/Log.txt</code> 与 <code>Log/AopSql/AopSql.txt</code>，并启用 <code>WriteTo.Async()</code> 防止阻塞请求线程。</li></ul><h3 id="多租户隔离模式示例" tabindex="-1">多租户隔离模式示例 <a class="header-anchor" href="#多租户隔离模式示例" aria-label="Permalink to &quot;多租户隔离模式示例&quot;">​</a></h3><ul><li><strong>字段隔离（单表）</strong>：<code>BusinessTable : ITenantEntity</code> 依赖 QueryFilter 自动按 <code>TenantId</code> 过滤；调用 <code>GET /api/Tenant/BusinessTable</code> 可查看仅当前租户可见的数据，<code>.http</code> 示例位于 <code>Radish.Api/Radish.Api.http</code>。</li><li><strong>表隔离</strong>：<code>MultiBusinessTable</code> 标注 <code>[MultiTenant(TenantTypeEnum.Tables)]</code>，<code>TenantUtil.SetTenantTable()</code> 会在运行期改写表名为 <code>表名_{TenantId}</code>，示例接口 <code>GET /api/Tenant/MultiBusinessTable</code>。</li><li><strong>分库隔离</strong>：<code>SubLibBusinessTable</code> 标注 <code>[MultiTenant(TenantTypeEnum.DataBases)]</code>，<code>TenantUtil.GetConnectionConfig()</code> 根据租户配置动态注入连接，示例接口 <code>GET /api/Tenant/SubLibBusinessTable</code>（参考 <code>.http</code> 文件）。租户主数据需在数据库中预配 <code>TenantConfigId/DbConnectionStr</code> 等字段，且 <code>App.HttpContextUser</code> 必须包含合法 <code>TenantId</code>。</li></ul><h2 id="跨语言扩展-rust-原生库" tabindex="-1">跨语言扩展（Rust 原生库） <a class="header-anchor" href="#跨语言扩展-rust-原生库" aria-label="Permalink to &quot;跨语言扩展（Rust 原生库）&quot;">​</a></h2><ul><li>目的：为 CPU 密集或高并发算法提供 Rust 实现，并通过 <code>[DllImport(&quot;test_lib&quot;)]</code> 在 <code>Radish.Api.Controllers.RustTest</code> 中验证性能差异。本阶段的 <code>Radish.Core/test_lib</code> 仅为演示，后续需将实际扩展迁入解决方案根目录的 <code>native/rust/{library}</code>，确保 Core 层保持纯 C# 领域模型。</li><li>构建流程： <ol><li>安装 Rust 工具链（rustup + nightly/stable 均可），在仓库根目录执行 <code>cd Radish.Core/test_lib &amp;&amp; cargo build --release</code>。</li><li>构建完成后会在 <code>target/release/</code> 生成 <code>test_lib.dll</code>（Windows）、<code>libtest_lib.so</code>（Linux）或 <code>libtest_lib.dylib</code>（macOS）。MSBuild/Docker 构建需在 <code>AfterBuild</code>/脚本阶段把对应文件拷贝到 <code>Radish.Api/bin/&lt;Configuration&gt;/net10.0/</code> 或发布目录，以便运行期自动加载。</li><li><code>RustTest</code> 控制器提供 <code>/api/RustTest/TestSum1~4</code> 四个端点，演示累加、类斐波那契、埃拉托斯特尼筛与并行质数计数；发布前请以 <code>?iterations=1_000_000</code> 等参数在本地验证返回结果与耗时。</li></ol></li><li>目录规划：真实业务扩展应在 <code>native/rust/&lt;库名&gt;</code> 下维护 Cargo 工程，并附 README 说明导出函数签名/调用约定。<code>Radish.Core/test_lib</code> 仅保留最小示例，迁移完成后可以删除或仅做文档参考。</li><li>提交规范：Rust <code>target/</code> 目录与生成的 <code>.dll/.so/.dylib</code> 依旧忽略，必要时在 <code>.gitignore</code> 中新增排除项；若需要在 CI 中编译 Rust，请在构建脚本中加入 <code>cargo build --release</code> 与共享库复制步骤，保持与 DevelopmentPlan 中的原生扩展规划一致。</li></ul><h2 id="实体与视图模型规范" tabindex="-1">实体与视图模型规范 <a class="header-anchor" href="#实体与视图模型规范" aria-label="Permalink to &quot;实体与视图模型规范&quot;">​</a></h2><ul><li>仓储层（Radish.Repository）只处理 <code>Radish.Model</code> 中定义的实体类型，禁止将实体对象直接向外暴露；Service 层获取实体后必须映射为视图模型再返回给 Controller。</li><li>视图模型命名以 <code>Vo</code> 为前缀，但不得只追加单个前缀；需结合业务含义进行缩写或扩写（例如 <code>VoUsrAudit</code>、<code>VoAssetReport</code>），从命名上进行模糊化以减少被直接猜测的风险。</li><li>AutoMapper Profile 中维护实体与视图模型的对应关系；如需手动映射，也必须在 Service 层完成，确保 Controller 不访问实体。</li><li>DTO/Vo 定义集中在 <code>Radish.Model</code> 或 <code>Radish.Shared</code> 的对应目录下，提交前请自检实体与视图模型字段是否同步更新。</li></ul><h2 id="automapper-与配置扩展" tabindex="-1">AutoMapper 与配置扩展 <a class="header-anchor" href="#automapper-与配置扩展" aria-label="Permalink to &quot;AutoMapper 与配置扩展&quot;">​</a></h2><ul><li><code>Radish.Extension/AutoMapperSetup</code> 负责集中注册全部 profile，并通过 <code>expression.ConstructServicesUsing</code> 使用 DI 容器解析依赖；新增 profile 时直接在 <code>AutoMapperConfig.RegisterProfiles</code> 中挂载。</li><li><code>AutoMapperConfig.RegisterCustomProfile</code> 可以配置全局规则（例如识别属性前缀/后缀、通用转换器），之后的 <code>RegisterProfiles</code> 列表挂载业务 profile（<code>RoleProfile</code>、<code>UserProfile</code>、<code>AuditSqlLogProfile</code> 等）；保持两段式注册可以避免 profile 顺序造成的耦合。</li><li><code>AuditSqlLogProfile</code> 已示范如何同时识别源和目标的 <code>Vo</code> 前缀：<code>RecognizeDestinationPrefixes(&quot;Vo&quot;)</code> + <code>RecognizePrefixes(&quot;Vo&quot;)</code> 使 <code>AuditSqlLog</code> 与 <code>AuditSqlLogVo</code> 能够双向自动映射，开发其他 Vo 模型时直接复用该写法即可。</li><li>AutoMapper 授权： <ul><li>在 <code>appsettings.{Environment}.json</code> 中新增 <code>AutoMapper:LicenseKey</code>，严禁提交真实 key，可通过用户密钥或 Secret Manager 注入。</li><li>运行时通过 <code>AppSettings.RadishApp(new[] { &quot;AutoMapper&quot;, &quot;LicenseKey&quot; }).ObjToString()</code> 读取，并在 <code>expression.LicenseKey</code> 上设置；为空时自动跳过，避免影响本地调试。</li></ul></li><li><code>Radish.Common.AppSettings</code> 为自定义配置入口，Program.cs 使用 <code>builder.Services.AddSingleton(new AppSettings(builder.Configuration));</code> 注册后即可在任何层注入/静态调用。 <ul><li>当需要分段读取配置时，统一调用 <code>AppSettings.RadishApp(params string[] sections)</code>，禁止在业务代码中自行 new ConfigurationBuilder，以保证配置来源一致。</li><li>强类型配置建议实现 <code>IConfigurableOptions</code>（位于 <code>Radish.Common.Option.Core</code>），由 <code>ConfigurableOptions</code> + <code>AllOptionRegister</code> 自动绑定，再通过 <code>IOptions&lt;T&gt;</code> 注入。</li></ul></li><li><code>Radish.Common.Core.App</code> 负责缓存 <code>Configuration/WebHostEnvironment/RootServices</code>，Program.cs 必须依次执行 <code>hostingContext.Configuration.ConfigureApplication()</code>、<code>builder.ConfigureApplication()</code>、<code>app.ConfigureApplication()</code> 与 <code>app.UseApplicationSetup()</code> 才能完成注入；仅在无法通过构造函数注入时，才在静态上下文调用 <code>App.GetService&lt;T&gt;</code>、<code>App.GetOptions&lt;T&gt;</code>，并优先保证线程安全与生命周期一致。</li><li>对应扩展支持 <code>Get&lt;T&gt;()</code>、<code>ObjToString()</code> 等常用方法，可在新增配置时同步补充注释，方便多人协作。</li></ul><h2 id="缓存策略" tabindex="-1">缓存策略 <a class="header-anchor" href="#缓存策略" aria-label="Permalink to &quot;缓存策略&quot;">​</a></h2><ul><li><code>Radish.Extension.RedisExtension.CacheSetup</code> 提供统一的 <code>AddCacheSetup()</code>，需在 Program 的服务注册阶段调用；该方法会读取 <code>Redis.Enable</code>/<code>Redis.ConnectionString</code>/<code>Redis.InstanceName</code> 并自动在 StackExchange.Redis 与内存缓存之间切换。</li><li>若 <code>Redis.Enable=true</code>，启动时会构建单例 <code>IConnectionMultiplexer</code> 并注册 <code>IRedisBasketRepository</code>（包含 List/Queue 等常用 API），其他场景使用 <code>Radish.Common.CacheTool.ICaching</code> 进行增删查；禁用 Redis 时自动回落到 <code>IMemoryCache</code> + <code>IDistributedMemoryCache</code>。</li><li>所有新增缓存键应通过 <code>ICaching.AddCacheKey*</code> 记录，便于 <code>DelByPattern</code>/<code>Clear</code> 等工具批量清理；若需发布订阅或队列语义，请依赖 <code>IRedisBasketRepository</code>，不要在业务代码中自行 new 连接。</li><li>请勿将生产 Redis 连接串直接写入仓库，示例配置仅用于本地调试，线上需要通过环境变量或 Secret Manager 注入。</li></ul><h2 id="aop-与日志" tabindex="-1">AOP 与日志 <a class="header-anchor" href="#aop-与日志" aria-label="Permalink to &quot;AOP 与日志&quot;">​</a></h2><ul><li><code>Radish.Extension/ServiceAop</code> 基于 Castle.DynamicProxy 实现接口拦截，当前主要用于捕捉 <code>BaseService&lt;,&gt;</code> 等应用服务的入参、响应与耗时信息，并通过 <code>AopLogInfo</code> 统一结构化输出。</li><li>常规业务日志统一调用 Serilog 静态方法（<code>Log.Information/Log.Warning/Log.Error</code> 等），除非框架/第三方库必须注入 <code>ILogger&lt;T&gt;</code> 才能工作，否则 Controller、Service 以及扩展类中都不再手动注入 <code>ILogger</code>，避免出现多套日志通道。</li><li><code>AutofacModuleRegister</code> 已在泛型服务注册时启用 <code>.EnableInterfaceInterceptors().InterceptedBy(ServiceAop)</code>，如果后续服务需要自定义拦截，可在同一位置扩展拦截器数组。</li><li><code>Radish.Common/AopLogInfo</code> 集中维护 AOP 日志字段，调用层仅负责填充必要属性并交给日志基础设施处理，避免在各服务中手写日志模型。</li></ul><h2 id="项目依赖约定" tabindex="-1">项目依赖约定 <a class="header-anchor" href="#项目依赖约定" aria-label="Permalink to &quot;项目依赖约定&quot;">​</a></h2><ul><li>前端依赖管理使用 npm 或 yarn，推荐使用 yarn 以提高安装速度和一致性</li><li>后端依赖管理使用 NuGet，推荐使用最新稳定版本的包（兼容 .NET 10）</li><li>所有第三方依赖需经过安全审查，确保无已知漏洞</li><li>定期更新依赖包，保持项目安全和性能</li><li>使用依赖锁定文件（如 package-lock.json 或 yarn.lock）确保团队成员使用相同版本的依赖</li><li>避免使用过时或不再维护的库，优先选择社区活跃且有良好文档支持的库</li><li>对于大型依赖，考虑使用按需加载或代码拆分以优化性能</li><li>记录所有依赖变更，确保团队成员了解更新内容和影响</li></ul><h2 id="示例实现与测试约定" tabindex="-1">示例实现与测试约定 <a class="header-anchor" href="#示例实现与测试约定" aria-label="Permalink to &quot;示例实现与测试约定&quot;">​</a></h2><ul><li><code>Radish.Api/Controllers/UserController</code>、<code>Radish.Service/UserService</code>、<code>Radish.Repository/UserRepository</code> 与对应的接口项目组成“用户列表”示例。该示例演示分层调用方式和 DI 注册写法，亦为 Swagger/.http 文件中的演示请求提供数据。</li><li>示例仓储目前返回内存中的 Alice/Bob 两条静态数据，供开发联调、单元测试与文档说明复用；如需扩展，请保持“接口契约 + 数据映射 + 控制器”结构。</li><li><code>Radish.Api.Tests/Controllers/UserControllerTest</code> 使用 xUnit 校验示例接口返回 <code>OkObjectResult</code>，且至少包含两条用户数据；任何对示例链路的改动都必须同步更新该测试。</li><li><code>Radish.Api/Radish.Api.http</code> 已加入“用户列表”调用示例，可在调试时直接复用；如新增演示接口，应当在 .http 文件中同步记录。</li></ul><h2 id="signalr-实时交互规范" tabindex="-1">SignalR 实时交互规范 <a class="header-anchor" href="#signalr-实时交互规范" aria-label="Permalink to &quot;SignalR 实时交互规范&quot;">​</a></h2><ul><li>Hub 位置：所有实时交互入口放在 <code>Radish.Api/Hubs</code>（命名为 <code>*Hub.cs</code>），继承 <code>Hub&lt;TClient&gt;</code> 以启用强类型调用；公共消息 DTO 定义在 <code>Radish.Model</code> 中，避免前后端字段不一致。</li><li>DI 与调用：业务服务通过注入 <code>IHubContext&lt;T&gt;</code> 或 <code>IHubContext&lt;T, TClient&gt;</code> 发送消息，禁止在 Controller 中直接 new Hub；需要跨层推送时在 Service 层聚合，保持仓储层不涉及实时推送。</li><li>客户端：<code>radish.client</code> 使用 <code>@microsoft/signalr</code>，连接封装在 <code>shared/signalr/useSignalrHub.ts</code>（预留）中，负责断线重连、心跳与 Token 附带；前端只暴露订阅型 API。</li><li>安全：Hub 仅接受已认证用户，连接时附带 JWT（Query 或 Header），后台在 <code>OnConnectedAsync</code> 验证租户/角色；Hub 方法命名遵循 PascalCase，禁止接受动态字符串并在方法内再次鉴权。</li><li>可扩展性：生产部署多实例时启用 Redis Backplane，并限制客户端分组订阅；压测期间通过 <code>MaximumReceiveMessageSize</code> 控制 payload，必要时启用 MessagePack 序列化。</li><li>调试：添加 <code>Radish.Api/Hubs/hubs.http</code> 或在现有 <code>.http</code> 文件中记录 <code>/negotiate</code> 请求；本地开发启用 <code>builder.Services.AddSignalR().AddJsonProtocol(...)</code> 并结合浏览器 Network 面板排查。</li></ul><h2 id="前后端通信安全要求" tabindex="-1">前后端通信安全要求 <a class="header-anchor" href="#前后端通信安全要求" aria-label="Permalink to &quot;前后端通信安全要求&quot;">​</a></h2><ul><li>所有前后端数据交互必须通过 HTTPS 进行，禁止使用明文 HTTP，确保传输链路具备 TLS 加密。</li><li>登录、密码重置、密保验证等含有敏感字段的请求，客户端需先使用项目约定的 RSA 公钥加密敏感参数，后端使用私钥解密，再进入业务流程。</li><li>若同时涉及本地缓存或离线存储，需确保不会以明文形式存储账号、密码、令牌等敏感信息。</li><li>公私钥对统一由后端团队生成和轮换，前端需在构建阶段或运行时安全加载最新公钥。</li><li>开发联调阶段同样遵循 HTTPS+RSA 约束，以防调试阶段泄漏敏感数据。</li></ul><h2 id="前端桌面化-ui-规范" tabindex="-1">前端桌面化 UI 规范 <a class="header-anchor" href="#前端桌面化-ui-规范" aria-label="Permalink to &quot;前端桌面化 UI 规范&quot;">​</a></h2><blockquote><p>详细的交互、设计 Token、跨端策略以 <a href="./FrontendDesign.html">FrontendDesign.md</a> 为准，此处保留关键守则，便于与后端规范并列查看。</p></blockquote><ul><li>radish.client 以桌面模式为核心交互范式，首页加载后呈现类似 macOS 的桌面界面。</li><li>顶部为状态栏，需显示当前登录用户名、IP 地址以及预留系统状态信息区域。</li><li>底部为 Dock 栏，用于承载核心功能快捷入口；点击或双击图标都应维持桌面操作逻辑和动效。</li><li>左侧屏幕区域展示社区功能图标，用户双击后需弹出大弹窗（模态窗口）显示对应功能内容。</li><li>弹窗左上角包含最小化与关闭按钮，交互样式参考 macOS；最小化后回到 Dock 或桌面图标，关闭后释放资源。</li><li>状态栏、Dock、桌面图标以及弹窗需要统一的外观主题和响应式策略，优先适配桌面端分辨率，对移动端访问给出限缩体验或引导。</li><li>参考实现：<code>radish.client/public/webos.html</code>（Nebula OS 示例）展示了开机过渡、可拖拽窗口、多任务任务栏、Start 菜单与预置 Terminal/Editor/Browser 等应用图标；任何新页面都应优先在该场景中定义窗口外观与交互再迁移至 React 组件，保持动画节奏、图标尺寸与控件布局一致。</li></ul><h2 id="radish-client-前端规范" tabindex="-1">radish.client 前端规范 <a class="header-anchor" href="#radish-client-前端规范" aria-label="Permalink to &quot;radish.client 前端规范&quot;">​</a></h2><blockquote><p>技术栈、目录结构、状态管理、测试策略等完整说明见 <a href="./FrontendDesign.html">FrontendDesign.md</a>，以下列出与后端协作密切的约束。</p></blockquote><ol><li>前后端传输的敏感字段计划使用 <code>encryptByPublicKey()</code> 加密，后端通过 <code>DecryptByPrivateKey()</code> 解密；方法虽未实现，但需提前规划调用点，保证接口兼容性。</li><li>组件统一使用函数式写法，结合 <code>useState</code>、<code>useMemo</code>、<code>useEffect</code> 等 Hook 管理状态与生命周期，避免继续编写 Class 组件。</li><li>使用 <code>const</code> 定义组件与内部函数，遵循 React 不可变范式，常规情况下避免 <code>function</code> 声明以减少作用域、提升与 <code>this</code> 绑定问题。</li><li>禁用 <code>var</code>，默认 <code>const</code>，仅在确需重新赋值时选用 <code>let</code>；在 React 顶层逻辑几乎无需 <code>let</code>，如需持久化可变值，优先用 <code>const + useState</code> 组合处理。</li><li>React Compiler 仍属实验功能，主干暂不启用；若官方 GA 后可在独立分支尝试 <code>babel-plugin-react-compiler</code>，确认与 <code>radish.client</code> 的桌面化 UI、第三方组件兼容且能明显减少手写 memo，再提交 PR 合入主线。</li></ol><h2 id="radish-api-接口规范" tabindex="-1">Radish.Api 接口规范 <a class="header-anchor" href="#radish-api-接口规范" aria-label="Permalink to &quot;Radish.Api 接口规范&quot;">​</a></h2><ol><li>API 方法全部位于 Server 层 Controller 命名空间，统一使用 <code>[Route(&quot;api/[controller]/[action]&quot;)]</code> 作为路由前缀。</li><li>需鉴权的 API 必须在 Controller 或 Action 上添加 <code>[Authorize(Permissions.Name)]</code>；无需鉴权的显式标注 <code>[AllowAnonymous]</code>，避免默认放行。</li><li>Controller Action 默认遵循 <code>[Produces(&quot;application/json&quot;)]</code> 与 RESTful 设计原则，除非业务场景要求其他内容类型或风格。</li><li>WeatherForecastController 中的 <code>GetById</code> 演示了 <code>[HttpGet(&quot;{id}&quot;)]</code> 路径参数写法，访问 <code>api/WeatherForecast/GetById/1</code> 可直接验证模型绑定；后续新增路由参数时沿用该示例的命名、注释和返回格式，便于单测覆盖。</li><li>实体类存放在 Model 层 <code>Models</code> 命名空间并继承 <code>RootEntityTKey&lt;TKey&gt;</code>（含主键 Id）；若有自定义外键实体，同样继承该基类。视图模型位于 <code>ViewModels</code> 命名空间，按对外暴露字段设计，无继承硬性要求。</li><li>实体与视图模型的映射集中在 Extension 层 <code>AutoMapper</code> 命名空间，每组实体定义独立 <code>CustomProfile</code>，避免在 Controller 或仓储中手动映射。</li><li>新增对外接口遵循以下流程： （1）在 Model 层定义实体与视图模型； （2）在 Extension 层配置映射关系； （3）在 Core 层实现算法或数据处理； （4）在 IService 层声明接口； （5）在 Service 层实现接口，注入 <code>IBaseRepository</code> 或专用仓储并完成映射； （6）（可选）若泛型仓储不满足需求，在 IRepository/Repository 层定义并实现专用仓储； （7）在 Server 层通过依赖注入调用 IService，完成数据返回或存储。</li><li>Server 层对外暴露的 Controller 禁止直接注入 <code>IBaseRepository</code> 或任何业务仓储，所有数据访问需经由 Service 层封装。</li><li>角色-API 授权依赖 <code>ApiModule.LinkUrl</code> 进行正则匹配，因此 URL 必须以 <code>/</code> 开头；若 Action 路由包含路径参数（如 <code>[HttpGet(&quot;{id:long}&quot;)]</code>），请在 <code>LinkUrl</code> 中写入对应的正则版本（示例：<code>/api/User/GetById/\d+</code>），否则 <code>RadishAuthPolicy</code> 无法命中该路由。</li></ol><h2 id="api-版本控制规范" tabindex="-1">API 版本控制规范 <a class="header-anchor" href="#api-版本控制规范" aria-label="Permalink to &quot;API 版本控制规范&quot;">​</a></h2><h3 id="版本控制策略" tabindex="-1">版本控制策略 <a class="header-anchor" href="#版本控制策略" aria-label="Permalink to &quot;版本控制策略&quot;">​</a></h3><ul><li>Radish 采用 <strong>URL 路径版本控制</strong>方式，这是业界标准且最直观的版本管理方案（GitHub、Stripe、Twitter 等主流 API 均采用此方案）。</li><li>版本号格式为 <code>v{major}.{minor}</code>，在 URL 路径中以 <code>v{major}</code> 形式体现（如 <code>v1</code>、<code>v2</code>）。</li><li>所有 API 路由必须包含版本号：<code>/api/v{version}/{controller}/{action}</code>。</li><li>使用 <code>Asp.Versioning.Mvc</code> (8.1.0) 和 <code>Asp.Versioning.Mvc.ApiExplorer</code> 提供版本控制支持。</li></ul><h3 id="controller-版本声明" tabindex="-1">Controller 版本声明 <a class="header-anchor" href="#controller-版本声明" aria-label="Permalink to &quot;Controller 版本声明&quot;">​</a></h3><p>每个 Controller 必须明确声明其所属的 API 版本：</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 声明为 v1 版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Route</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;api/v{version:apiVersion}/[controller]/[action]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Produces</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;功能模块&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ControllerBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Actions...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>关键特性说明：</strong></p><ul><li><code>[ApiVersion(&quot;1.0&quot;)]</code>: 声明 Controller 支持的版本，可同时声明多个版本</li><li><code>v{version:apiVersion}</code>: 路由模板中的版本占位符，运行时自动替换为实际版本号</li><li>版本号采用 Major.Minor 格式（如 1.0, 2.0）</li><li>URL 中显示为 v1, v2（由 <code>GroupNameFormat = &quot;&#39;v&#39;VVV&quot;</code> 配置）</li></ul><h3 id="版本划分原则" tabindex="-1">版本划分原则 <a class="header-anchor" href="#版本划分原则" aria-label="Permalink to &quot;版本划分原则&quot;">​</a></h3><p><strong>v1 (稳定版本)：</strong></p><ul><li>核心业务接口：用户管理、认证授权等</li><li>已发布到生产环境的稳定 API</li><li>必须保持向后兼容，不得破坏性变更</li><li>示例：LoginController、UserController</li></ul><p><strong>v2 及更高版本（预览/实验版本）：</strong></p><ul><li>新功能接口：系统管理、性能测试等</li><li>实验性功能或重大重构</li><li>可包含破坏性变更</li><li>示例：AppSettingController (v2)、RustTestController (v2)</li></ul><h3 id="openapi-文档配置" tabindex="-1">OpenAPI 文档配置 <a class="header-anchor" href="#openapi-文档配置" aria-label="Permalink to &quot;OpenAPI 文档配置&quot;">​</a></h3><p><strong>自动文档生成：</strong></p><ul><li>系统通过 <code>IApiVersionDescriptionProvider</code> 自动发现所有 API 版本</li><li>为每个版本动态生成独立的 OpenAPI 文档（<code>/openapi/v1.json</code>, <code>/openapi/v2.json</code>）</li><li>Scalar UI 自动展示版本选择下拉菜单，切换版本时文档内容自动过滤</li></ul><p><strong>文档配置位置：</strong></p><ul><li><code>Radish.Extension/OpenApiExtension/ScalarSetup.cs</code> 负责统一配置</li><li>每个版本的文档描述、示例、服务器列表均可独立定制</li><li>支持版本弃用标记（在 <code>Info.Description</code> 中添加警告）</li></ul><p><strong>Scalar UI 版本切换：</strong></p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在 ScalarSetup.cs 中自动配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">options</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;V1 (1.0)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/openapi/v1.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isDefault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;V2 (2.0)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/openapi/v2.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="xml-注释规范" tabindex="-1">XML 注释规范 <a class="header-anchor" href="#xml-注释规范" aria-label="Permalink to &quot;XML 注释规范&quot;">​</a></h3><p>所有 Controller 和 Action 必须提供完整的 XML 注释：</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// 功能简述</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;paramName&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;参数说明&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">param</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;返回值说明&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">returns</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">remarks</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// 详细说明，包括：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// - 业务逻辑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// - 请求示例</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// - 响应示例</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// - 注意事项</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">remarks</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> code</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;200&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;成功响应说明&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> code</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;401&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;未授权说明&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">response</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HttpGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProducesResponseType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessageModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;), StatusCodes.Status200OK)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ProducesResponseType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessageModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), StatusCodes.Status401Unauthorized)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessageModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MyAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> paramName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>关键要求：</strong></p><ul><li>必须启用 XML 文档生成（在 <code>.csproj</code> 中配置 <code>&lt;GenerateDocumentationFile&gt;true&lt;/GenerateDocumentationFile&gt;</code>）</li><li>使用 <code>[ProducesResponseType]</code> 明确声明所有可能的响应状态码</li><li>使用 <code>[Tags]</code> 对 API 进行分组（如&quot;认证管理&quot;、&quot;用户管理&quot;、&quot;系统管理&quot;）</li><li>为 v2+ 版本在注释中标注 &quot;(v2)&quot; 等版本标识</li></ul><h3 id="版本迁移指南" tabindex="-1">版本迁移指南 <a class="header-anchor" href="#版本迁移指南" aria-label="Permalink to &quot;版本迁移指南&quot;">​</a></h3><p><strong>添加新版本：</strong></p><ol><li>创建新的 Controller 或复制现有 Controller</li><li>修改 <code>[ApiVersion]</code> 特性为新版本号（如 &quot;2.0&quot;）</li><li>更新 XML 注释说明版本差异</li><li>在 <code>ScalarSetup.cs</code> 中为新版本添加专属描述</li></ol><p><strong>弃用旧版本：</strong></p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Deprecated</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span></code></pre></div><ul><li>添加 <code>Deprecated = true</code> 标记</li><li>OpenAPI 文档会自动显示&quot;已弃用&quot;警告</li><li>保留至少一个完整版本周期再移除</li></ul><p><strong>跨版本支持：</strong></p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ApiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ControllerBase</span></span></code></pre></div><ul><li>Controller 可同时支持多个版本</li><li>使用 <code>[MapToApiVersion(&quot;2.0&quot;)]</code> 标记特定 Action 的版本</li></ul><h3 id="版本控制配置-program-cs" tabindex="-1">版本控制配置（Program.cs） <a class="header-anchor" href="#版本控制配置-program-cs" aria-label="Permalink to &quot;版本控制配置（Program.cs）&quot;">​</a></h3><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.Services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddApiVersioning</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options.ReportApiVersions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 响应头报告支持的版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options.AssumeDefaultVersionWhenUnspecified </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 未指定版本时使用默认版本</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options.DefaultApiVersion </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ApiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 默认版本 1.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddMvc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddApiExplorer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options.GroupNameFormat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&#39;v&#39;VVV&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// URL 中显示为 v1, v2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options.SubstituteApiVersionInUrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自动替换路由中的版本占位符</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="url-格式示例" tabindex="-1">URL 格式示例 <a class="header-anchor" href="#url-格式示例" aria-label="Permalink to &quot;URL 格式示例&quot;">​</a></h3><p><strong>v1 接口：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>GET /api/v1/Login/GetJwtToken?name=admin&amp;pass=123456</span></span>
<span class="line"><span>GET /api/v1/User/GetUserList</span></span>
<span class="line"><span>GET /api/v1/User/GetUserById/123456789</span></span></code></pre></div><p><strong>v2 接口：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>GET /api/v2/AppSetting/GetRedisConfig</span></span>
<span class="line"><span>GET /api/v2/RustTest/TestSum1?iterations=1000000</span></span></code></pre></div><h3 id="版本响应头" tabindex="-1">版本响应头 <a class="header-anchor" href="#版本响应头" aria-label="Permalink to &quot;版本响应头&quot;">​</a></h3><p>启用 <code>ReportApiVersions</code> 后，响应头会包含版本信息：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>api-supported-versions: 1.0, 2.0</span></span>
<span class="line"><span>api-deprecated-versions: (空或已弃用的版本)</span></span></code></pre></div><h3 id="文档访问" tabindex="-1">文档访问 <a class="header-anchor" href="#文档访问" aria-label="Permalink to &quot;文档访问&quot;">​</a></h3><ul><li><strong>Scalar UI</strong>: <code>https://localhost:7110/api/docs</code></li><li><strong>OpenAPI JSON</strong>: <ul><li>v1: <code>https://localhost:7110/openapi/v1.json</code></li><li>v2: <code>https://localhost:7110/openapi/v2.json</code></li></ul></li></ul><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h3><p><strong>Q: 是否可以不指定版本？</strong> A: 不推荐。虽然系统会使用默认版本 (v1.0)，但显式指定版本更清晰。</p><p><strong>Q: 如何在权限表中配置版本化 URL？</strong> A: <code>ApiModule.LinkUrl</code> 中必须包含版本号的正则，例如：<code>/api/v1/User/GetUserList</code> 或 <code>/api/v\d+/User/GetUserList</code>。</p><p><strong>Q: 前端如何调用不同版本？</strong> A: 直接修改 URL 路径中的版本号即可，无需修改请求头或参数。</p><p><strong>Q: 是否支持查询参数或请求头版本控制？</strong> A: 系统支持但不推荐。URL 路径版本控制是最佳实践，工具支持最好，用户体验最佳。</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/docs/" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>项目概览</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/docs/DevelopmentFramework.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>开发框架说明</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"authenticationguide.md\":\"Uw5NSHPd\",\"configurationguide.md\":\"Sw0Kb26V\",\"deploymentguide.md\":\"CAFBaCQx\",\"developmentframework.md\":\"nXzUIeHD\",\"developmentlog.md\":\"DlG7OOHi\",\"developmentplan.md\":\"BSNeTUe-\",\"developmentspecifications.md\":\"DtLMyQ61\",\"frontenddesign.md\":\"OT6fA1DJ\",\"gatewayplan.md\":\"QHuMakt9\",\"index.md\":\"RVDAGLzy\",\"openplatformguide.md\":\"BVxeLwOz\",\"readme.md\":\"DSs6HDJd\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Radish 文档\",\"description\":\"Radish 社区平台文档\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"开发文档\",\"link\":\"/DevelopmentSpecifications\"},{\"text\":\"架构设计\",\"link\":\"/DevelopmentFramework\"},{\"text\":\"部署运维\",\"link\":\"/DeploymentGuide\"}],\"sidebar\":{\"/\":[{\"text\":\"快速开始\",\"items\":[{\"text\":\"项目概览\",\"link\":\"/\"}]},{\"text\":\"开发指南\",\"items\":[{\"text\":\"开发规范\",\"link\":\"/DevelopmentSpecifications\"},{\"text\":\"开发框架说明\",\"link\":\"/DevelopmentFramework\"},{\"text\":\"认证与权限\",\"link\":\"/AuthenticationGuide\"},{\"text\":\"前端设计\",\"link\":\"/FrontendDesign\"},{\"text\":\"Gateway 规划\",\"link\":\"/GatewayPlan\"}]},{\"text\":\"部署与运维\",\"items\":[{\"text\":\"部署指南\",\"link\":\"/DeploymentGuide\"},{\"text\":\"开发计划\",\"link\":\"/DevelopmentPlan\"},{\"text\":\"开发日志\",\"link\":\"/DevelopmentLog\"}]}]},\"outline\":\"deep\",\"socialLinks\":[]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>