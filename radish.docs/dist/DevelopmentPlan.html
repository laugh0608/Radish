<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发路线图（按周计划） | Radish 文档</title>
    <meta name="description" content="Radish 社区平台文档">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/docs/assets/style.DuOwLuGy.css" as="style">
    <link rel="preload stylesheet" href="/docs/vp-icons.css" as="style">
    
    <script type="module" src="/docs/assets/app.DrLBQsnq.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.DXkXcpDi.js">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.DdJmP4Xu.js">
    <link rel="modulepreload" href="/docs/assets/DevelopmentPlan.md.BSNeTUe-.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/docs/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Radish 文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/DevelopmentSpecifications.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>开发文档</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/DevelopmentFramework.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>架构设计</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/DeploymentGuide.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>部署运维</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>快速开始</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>项目概览</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>开发指南</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentSpecifications.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentFramework.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发框架说明</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/AuthenticationGuide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>认证与权限</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/FrontendDesign.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>前端设计</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/GatewayPlan.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Gateway 规划</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>部署与运维</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DeploymentGuide.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>部署指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentPlan.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发计划</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/docs/DevelopmentLog.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>开发日志</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _docs_DevelopmentPlan" data-v-39a288b8><div><h1 id="开发路线图-按周计划" tabindex="-1">开发路线图（按周计划） <a class="header-anchor" href="#开发路线图-按周计划" aria-label="Permalink to &quot;开发路线图（按周计划）&quot;">​</a></h1><blockquote><p>本计划基于当前仓库分层结构（Radish.Api、Radish.Core、Radish.Service、Radish.Repository、Radish.Model、radish.client 等）制定，聚焦「.NET 10 + SQLSugar + PostgreSQL + React 19 (Vite + Node 24)」技术栈。与 <a href="./DevelopmentFramework.html">docs/DevelopmentFramework.md</a> 描述的总体架构保持一致，但更强调按周可交付的节奏与验收标准。</p></blockquote><p>相关文档</p><ul><li>开发日志: <a href="./DevelopmentLog.html">DevelopmentLog.md</a></li><li>部署指引: <a href="./DeploymentGuide.html">DeploymentGuide.md</a></li></ul><h2 id="目标与范围" tabindex="-1">目标与范围 <a class="header-anchor" href="#目标与范围" aria-label="Permalink to &quot;目标与范围&quot;">​</a></h2><ul><li><strong>基础基线</strong>：.NET 10 SDK、SQLSugar、PostgreSQL 16、本地或容器化运行；前端统一使用 React（不再维护 Angular）。</li><li><strong>配置策略</strong>：<code>appsettings.{Env}.json</code> + 环境变量 + <code>.env</code>; 前端通过 <code>.env.local</code> 注入 <code>VITE_API_BASE_URL</code> 等；敏感值仅存储在 Secret Manager 或密钥管控服务。</li><li><strong>交付要求</strong>：每周至少完成一个端到端可演示的用例（后端 API + 前端界面 + 文档/测试），并在 DevelopmentLog 中留下记录。</li><li><strong>前端体验</strong>：桌面化 UI、移动适配与 React Native 规划须遵循 <a href="./FrontendDesign.html">FrontendDesign.md</a>，各阶段完成度以该文档的 Token/组件/交互 checklist 为准。</li></ul><h2 id="里程碑概览" tabindex="-1">里程碑概览 <a class="header-anchor" href="#里程碑概览" aria-label="Permalink to &quot;里程碑概览&quot;">​</a></h2><table tabindex="0"><thead><tr><th>周次</th><th>主题</th><th>目标</th><th>验收</th></tr></thead><tbody><tr><td>M1</td><td>基线设施</td><td>API 宿主、SQLSugar 与 PostgreSQL 通路、健康检查、React 脚手架</td><td><code>dotnet run Radish.Api</code> + React dev server 均可访问；数据库初始化脚本可重复执行</td></tr><tr><td>M2</td><td>领域建模</td><td>分类/帖子/评论聚合、SQLSugar 仓储、迁移/种子脚本</td><td>CRUD + 分页 API 可用，单测覆盖核心聚合</td></tr><tr><td>M3</td><td>OIDC 认证中心</td><td>Radish.Auth 项目、OpenIddict 配置、用户/角色/租户/权限模型、DbSeed 初始化、客户端管理 API</td><td>OIDC 发现文档可访问；Scalar 可通过 OAuth 授权调试 API；客户端 CRUD API 可用</td></tr><tr><td>M4</td><td>前端框架与认证</td><td>桌面模式骨架、基础组件库、OIDC 客户端集成、后台应用管理界面</td><td>React 可完成 OIDC 登录/登出/自动续期；后台可动态配置客户端；桌面 Shell 可用</td></tr><tr><td>M5</td><td>React MVP</td><td>列表/详情/发帖/评论链路、状态管理（React Query）、桌面化 UI 规范</td><td>前端提供桌面模式的社区主要流程，含 Loading/Empty/Error 状态</td></tr><tr><td>M6</td><td>积分与商城</td><td>积分规则、事件订阅、商城商品与库存、购买链路</td><td>发帖/互动触发积分，商城购买扣减积分并更新权益</td></tr><tr><td>M7</td><td>可观测性与测试</td><td>日志/Tracing、性能调优、自动化测试、CI 脚本</td><td><code>dotnet test</code> + <code>npm run test</code> 通过；Serilog/O11y 配置完成；性能基线达到 P95≤200ms</td></tr><tr><td>M8</td><td>部署与运维</td><td>Dockerfile/Compose、自监控、变更文档</td><td><code>docker compose up --build</code> 一键拉起 PostgreSQL + API + Auth + 前端；文档覆盖常见排障</td></tr><tr><td>M9（暂缓）</td><td>Gateway &amp; BFF 策略</td><td>Gateway PoC（Ocelot 路由 + 认证透传）与聚合 API 设计，仅在多服务/多入口明确后启动</td><td>在 <code>DevelopmentLog</code> 记录启动审批 + 回滚预案；保证现有 API 维持直连能力</td></tr></tbody></table><blockquote><p>当前迭代聚焦 M3-M4 的 Radish.Auth 与 WebOS OIDC 接入。Gateway 相关任务被移至 M9，并标记为“暂缓”，除保留 Header/Token 兼容性外不投入实现资源。</p></blockquote><h2 id="按周计划" tabindex="-1">按周计划 <a class="header-anchor" href="#按周计划" aria-label="Permalink to &quot;按周计划&quot;">​</a></h2><h3 id="第-1-周-运行基线-数据接入" tabindex="-1">第 1 周｜运行基线 &amp; 数据接入 <a class="header-anchor" href="#第-1-周-运行基线-数据接入" aria-label="Permalink to &quot;第 1 周｜运行基线 &amp; 数据接入&quot;">​</a></h3><ul><li><strong>后端</strong>： <ul><li>生成 SQLSugar 上下文，接入 PostgreSQL（ConnectionStrings__Default）。</li><li>添加健康检查 <code>/health</code> <code>/ready</code>，并暴露 Swagger/Scalar。</li><li>引入 Serilog + 配置加载（JSON + env + user-secrets）。</li></ul></li><li><strong>数据库</strong>： <ul><li>创建 <code>Radish</code> 数据库，编写初始化脚本（SqlSugar <code>InitTables</code> + 种子）。</li><li>提供 <code>scripts/init-db.sql</code> 或 CLI 命令，确保幂等。</li></ul></li><li><strong>前端</strong>： <ul><li>初始化 React 19 + Vite 项目结构，配置别名、ESLint、Prettier。</li><li>设置 <code>.env.local</code>（示例 <code>VITE_API_BASE_URL=http://localhost:5000</code>）。</li></ul></li><li><strong>验收</strong>：<code>dotnet build/test</code> 全绿；数据库脚本可重复执行；React <code>npm run dev</code> 成功读取健康检查结果。</li></ul><h3 id="第-2-周-领域建模与仓储" tabindex="-1">第 2 周｜领域建模与仓储 <a class="header-anchor" href="#第-2-周-领域建模与仓储" aria-label="Permalink to &quot;第 2 周｜领域建模与仓储&quot;">​</a></h3><ul><li><strong>Domain/Core</strong>：建模 Category/Post/Comment/Tag 等聚合，不变式与领域事件。</li><li><strong>Repository</strong>：SQLSugar 仓储实现，封装分页、过滤、事务、软删除。</li><li><strong>Service</strong>：实现最小 <code>CategoryAppService</code> 与 <code>PostAppService</code>（列表、详情、创建）。</li><li><strong>测试</strong>：<code>Radish.Api.Tests</code> 补充聚合与仓储单测。</li><li><strong>验收</strong>：Swagger 可调试 CRUD；分页/排序参数生效；关键测试通过。</li></ul><blockquote><p>⚠️ OIDC 认证中心（M3）是所有后续 WebOS/OIDC 集成与客户端管理的前置条件，资源投入优先保证本阶段可交付；Gateway 相关能力仅保留接口兼容性，不在 M1-M4 执行。</p></blockquote><h3 id="第-3-周-oidc-认证中心与数据初始化" tabindex="-1">第 3 周｜OIDC 认证中心与数据初始化 <a class="header-anchor" href="#第-3-周-oidc-认证中心与数据初始化" aria-label="Permalink to &quot;第 3 周｜OIDC 认证中心与数据初始化&quot;">​</a></h3><h4 id="_3-1-创建-radish-auth-项目" tabindex="-1">3.1 创建 Radish.Auth 项目 <a class="header-anchor" href="#_3-1-创建-radish-auth-项目" aria-label="Permalink to &quot;3.1 创建 Radish.Auth 项目&quot;">​</a></h4><ul><li><strong>项目结构</strong>：新建 ASP.NET Core 项目，独立运行在 <code>:7100</code> 端口</li><li><strong>依赖引入</strong>：OpenIddict 核心包（OpenIddict.AspNetCore、OpenIddict.EntityFrameworkCore 或自定义 SqlSugar 存储）</li><li><strong>端点配置</strong>： <ul><li><code>/connect/authorize</code> - 授权端点</li><li><code>/connect/token</code> - Token 端点</li><li><code>/connect/userinfo</code> - 用户信息端点</li><li><code>/connect/logout</code> - 登出端点</li><li><code>/.well-known/openid-configuration</code> - 发现文档</li></ul></li></ul><h4 id="_3-2-身份数据模型设计" tabindex="-1">3.2 身份数据模型设计 <a class="header-anchor" href="#_3-2-身份数据模型设计" aria-label="Permalink to &quot;3.2 身份数据模型设计&quot;">​</a></h4><ul><li><strong>实体定义</strong>（<code>Radish.Model/Models/Identity/</code>）： <ul><li><code>User.cs</code> - 用户实体（支持多租户）</li><li><code>Role.cs</code> - 角色实体</li><li><code>UserRole.cs</code> - 用户-角色关联</li><li><code>UserClaim.cs</code> - 用户声明</li><li><code>Tenant.cs</code> - 租户实体</li><li><code>Permission.cs</code> - 权限定义</li><li><code>RolePermission.cs</code> - 角色-权限关联</li></ul></li><li><strong>OpenIddict 实体</strong>：Application、Authorization、Scope、Token</li></ul><h4 id="_3-3-实现-radish-dbseed-项目" tabindex="-1">3.3 实现 Radish.DbSeed 项目 <a class="header-anchor" href="#_3-3-实现-radish-dbseed-项目" aria-label="Permalink to &quot;3.3 实现 Radish.DbSeed 项目&quot;">​</a></h4><ul><li>创建控制台项目或 CLI 工具</li><li>初始化数据库表结构（SqlSugar InitTables）</li><li>种子数据： <ul><li>默认租户（Main Tenant）</li><li>管理员用户（admin/System）</li><li>基础角色（System、Admin、User）</li><li>系统权限与 API 模块</li></ul></li><li>预置内部 OIDC 客户端（通过数据库存储，非硬编码）： <ul><li><code>radish-client</code> - WebOS 前端客户端（包含所有子应用）</li><li><code>radish-scalar</code> - API 文档客户端</li><li><code>radish-rust-ext</code> - Rust 扩展项目客户端</li></ul></li></ul><h4 id="_3-4-客户端管理-api" tabindex="-1">3.4 客户端管理 API <a class="header-anchor" href="#_3-4-客户端管理-api" aria-label="Permalink to &quot;3.4 客户端管理 API&quot;">​</a></h4><ul><li><strong>数据模型扩展</strong>：<div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 扩展 OpenIddict Application 实体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RadishApplication</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Logo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeveloperName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DeveloperEmail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ApplicationStatus</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Active/Disabled</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ApplicationType</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AppType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; } </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Internal/ThirdParty</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DateTime</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CreatedAt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CreatedBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>API 端点</strong>（<code>/api/clients</code>）： <ul><li><code>GET /api/clients</code> - 获取客户端列表（分页、筛选）</li><li><code>GET /api/clients/{id}</code> - 获取客户端详情</li><li><code>POST /api/clients</code> - 创建客户端</li><li><code>PUT /api/clients/{id}</code> - 更新客户端</li><li><code>DELETE /api/clients/{id}</code> - 删除客户端</li><li><code>POST /api/clients/{id}/reset-secret</code> - 重置 ClientSecret</li><li><code>POST /api/clients/{id}/toggle-status</code> - 启用/禁用客户端</li></ul></li><li><strong>权限控制</strong>：仅 System/Admin 角色可访问</li></ul><h4 id="_3-5-scalar-oauth-集成" tabindex="-1">3.5 Scalar OAuth 集成 <a class="header-anchor" href="#_3-5-scalar-oauth-集成" aria-label="Permalink to &quot;3.5 Scalar OAuth 集成&quot;">​</a></h4><ul><li>修改 <code>Radish.Api/Program.cs</code> 配置 Scalar OAuth：<div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MapScalarApiReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithOAuth2Configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oauth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        oauth.ClientId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;radish-scalar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        oauth.Scopes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;profile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;radish-api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div></li><li>验收：访问 <code>/scalar</code> 可跳转到 Auth 登录，授权后返回并携带 Token</li></ul><h4 id="验收标准" tabindex="-1">验收标准 <a class="header-anchor" href="#验收标准" aria-label="Permalink to &quot;验收标准&quot;">​</a></h4><ul><li><code>/.well-known/openid-configuration</code> 返回正确的 OIDC 发现文档</li><li>DbSeed 可重复执行且幂等</li><li>Scalar 文档通过 OAuth 授权后可调试受保护 API</li><li>多客户端（Scalar、前端、后台）注册完成</li></ul><h3 id="第-4-周-前端-webos-架构与-oidc-认证" tabindex="-1">第 4 周｜前端 WebOS 架构与 OIDC 认证 <a class="header-anchor" href="#第-4-周-前端-webos-架构与-oidc-认证" aria-label="Permalink to &quot;第 4 周｜前端 WebOS 架构与 OIDC 认证&quot;">​</a></h3><h4 id="_4-1-webos-架构-超级应用" tabindex="-1">4.1 WebOS 架构（超级应用） <a class="header-anchor" href="#_4-1-webos-架构-超级应用" aria-label="Permalink to &quot;4.1 WebOS 架构（超级应用）&quot;">​</a></h4><ul><li><strong>核心理念</strong>：Radish 是一个运行在浏览器中的操作系统</li><li><strong>单体应用结构</strong>（<code>radish.client</code>）：<div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>radish.client/</span></span>
<span class="line"><span>├── src/</span></span>
<span class="line"><span>│   ├── desktop/         # 桌面系统核心</span></span>
<span class="line"><span>│   ├── apps/            # 子应用（论坛/聊天/商城/后台管理）</span></span>
<span class="line"><span>│   ├── widgets/         # 桌面小部件</span></span>
<span class="line"><span>│   ├── shared/          # 共享代码</span></span>
<span class="line"><span>│   └── stores/          # 全局状态</span></span></code></pre></div></li><li>详见 <code>FrontendDesign.md</code></li></ul><h4 id="_4-2-桌面系统基础" tabindex="-1">4.2 桌面系统基础 <a class="header-anchor" href="#_4-2-桌面系统基础" aria-label="Permalink to &quot;4.2 桌面系统基础&quot;">​</a></h4><ul><li><strong>核心组件</strong>： <ul><li><code>Shell.tsx</code> - 桌面外壳容器</li><li><code>StatusBar.tsx</code> - 顶部状态栏（用户名、IP、消息、系统状态）</li><li><code>Desktop.tsx</code> - 桌面图标网格（基于权限动态显示）</li><li><code>Dock.tsx</code> - 底部 Dock 栏（运行中应用）</li><li><code>WindowManager.tsx</code> - 窗口管理器（窗口/全屏/iframe 模式）</li><li><code>AppRegistry.tsx</code> - 应用注册表</li></ul></li></ul><h4 id="_4-3-应用注册系统" tabindex="-1">4.3 应用注册系统 <a class="header-anchor" href="#_4-3-应用注册系统" aria-label="Permalink to &quot;4.3 应用注册系统&quot;">​</a></h4><ul><li><strong>注册表定义</strong>：<div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AppDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  icon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  component</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> React</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;window&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fullscreen&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;iframe&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  requiredRoles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><strong>预置应用</strong>： <ul><li>论坛（<code>forum</code>）- 窗口模式</li><li>聊天室（<code>chat</code>）- 窗口模式</li><li>商城（<code>shop</code>）- 全屏模式</li><li>后台管理（<code>admin</code>）- 全屏模式，仅 Admin/System 可见</li><li>API 文档（<code>docs</code>）- iframe 模式</li></ul></li></ul><h4 id="_4-4-子应用开发" tabindex="-1">4.4 子应用开发 <a class="header-anchor" href="#_4-4-子应用开发" aria-label="Permalink to &quot;4.4 子应用开发&quot;">​</a></h4><ul><li><strong>论坛应用</strong>（<code>apps/forum/</code>）： <ul><li>帖子列表、详情、发帖、评论</li><li>窗口模式，可多开</li></ul></li><li><strong>后台管理应用</strong>（<code>apps/admin/</code>）： <ul><li>使用 Ant Design 组件</li><li>全屏模式，独占桌面</li><li>核心模块：应用管理、用户管理、角色管理</li></ul></li><li><strong>聊天室应用</strong>（<code>apps/chat/</code>）：预留</li><li><strong>商城应用</strong>（<code>apps/shop/</code>）：预留</li></ul><h4 id="_4-5-oidc-客户端集成" tabindex="-1">4.5 OIDC 客户端集成 <a class="header-anchor" href="#_4-5-oidc-客户端集成" aria-label="Permalink to &quot;4.5 OIDC 客户端集成&quot;">​</a></h4><ul><li>使用 <code>oidc-client-ts</code> 或 <code>react-oidc-context</code></li><li>配置文件（<code>shared/auth/oidc-config.ts</code>）：<div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> oidcConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  authority: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://localhost:7100&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  client_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;radish-client&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  redirect_uri: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://localhost:58794/callback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  post_logout_redirect_uri: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://localhost:58794&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scope: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;openid profile radish-api offline_access&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  response_type: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;code&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  automaticSilentRenew: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div></li><li>实现认证流程： <ul><li>登录跳转 → Auth 授权页 → 回调处理 → Token 存储</li><li>静默续期（iframe 或 refresh_token）</li><li>登出（清除本地 + 调用 Auth 登出端点）</li></ul></li><li><strong>桌面权限控制</strong>：根据用户角色动态显示应用图标</li></ul><h4 id="_4-6-radish-api-资源服务器配置" tabindex="-1">4.6 Radish.Api 资源服务器配置 <a class="header-anchor" href="#_4-6-radish-api-资源服务器配置" aria-label="Permalink to &quot;4.6 Radish.Api 资源服务器配置&quot;">​</a></h4><ul><li>配置 JWT Bearer 验证：<div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.Services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddAuthentication</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddJwtBearer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        options.Authority </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://localhost:7100&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        options.Audience </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;radish-api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        options.TokenValidationParameters </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TokenValidationParameters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ValidateIssuer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ValidateAudience </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ValidateLifetime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span></code></pre></div></li><li>保留 <code>PermissionRequirementHandler</code> 动态权限校验</li><li>更新现有控制器的 <code>[Authorize]</code> 策略</li></ul><h4 id="_4-7-安全增强" tabindex="-1">4.7 安全增强 <a class="header-anchor" href="#_4-7-安全增强" aria-label="Permalink to &quot;4.7 安全增强&quot;">​</a></h4><ul><li>HTTPS 强制（开发/生产均启用）</li><li>CORS 配置（Auth、API、前端、后台跨域）</li><li>速率限制中间件</li><li>审计日志（登录/登出/敏感操作）</li></ul><h4 id="验收标准-1" tabindex="-1">验收标准 <a class="header-anchor" href="#验收标准-1" aria-label="Permalink to &quot;验收标准&quot;">​</a></h4><ul><li>桌面系统可正常渲染（状态栏、Dock、桌面图标）</li><li>桌面根据用户角色动态显示应用图标（普通用户看不到后台管理）</li><li>双击应用图标可打开窗口/全屏应用</li><li>论坛应用（窗口模式）基本可用：帖子列表、详情页</li><li>后台管理应用（全屏模式）可访问应用管理模块</li><li>后台可动态创建/编辑/删除 OIDC 客户端</li><li>OIDC 认证流程完整：登录 → 授权 → 回调 → 调用 API → 登出</li><li>Token 自动续期正常工作</li><li>未授权访问返回 401，权限不足返回 403</li><li>登录后状态栏显示用户信息</li><li>Dock 正确显示运行中的应用</li></ul><h3 id="第-5-周-react-mvp-内容浏览与创作" tabindex="-1">第 5 周｜React MVP（内容浏览与创作） <a class="header-anchor" href="#第-5-周-react-mvp-内容浏览与创作" aria-label="Permalink to &quot;第 5 周｜React MVP（内容浏览与创作）&quot;">​</a></h3><ul><li>页面： <ul><li>桌面模式首页：顶部状态栏（显示用户名/IP）、底部 Dock 栏、左侧功能图标。</li><li>列表（分类筛选、分页、排序）。</li><li>帖子详情 + 评论树。</li><li>发帖/编辑（富文本或 Markdown）。</li></ul></li><li>状态管理：React Query + Zustand；错误/空数据反馈。</li><li>UI：组件库（自研/Tailwind），深色模式，响应式布局；桌面模式窗口（含最小化/关闭按钮）与 Dock/图标交互。</li><li>验收：登录后可完成“浏览→详情→发帖→评论”闭环；核心接口的数据缓存与更新正确。</li></ul><h3 id="第-6-周-互动、积分与商城基础" tabindex="-1">第 6 周｜互动、积分与商城基础 <a class="header-anchor" href="#第-6-周-互动、积分与商城基础" aria-label="Permalink to &quot;第 6 周｜互动、积分与商城基础&quot;">​</a></h3><ul><li>点赞/收藏：后端提供幂等接口（Upsert），前端按钮即时反馈与回滚。</li><li>积分：事件（发帖/评论/点赞）触发积分流水；<code>PointLedger</code>、<code>PointTransaction</code>。</li><li>商城雏形：商品管理、库存、购买接口；前端展示商品列表与购买流程。</li><li>验收：触发积分后可在“个人中心”看到余额与流水；购买商品扣减库存与积分。</li></ul><h3 id="第-7-周-可观测性、测试与性能" tabindex="-1">第 7 周｜可观测性、测试与性能 <a class="header-anchor" href="#第-7-周-可观测性、测试与性能" aria-label="Permalink to &quot;第 7 周｜可观测性、测试与性能&quot;">​</a></h3><ul><li>自动化：补齐 xUnit/Vitest + Playwright（可选）测试，纳入 CI。</li><li>性能：PostgreSQL 索引审计、缓存策略（IMemoryCache/redis 预留）、SQLSugar Profiling。</li><li>Observability：Serilog → Seq/Console JSON；OpenTelemetry 采样；健康检查拓展。</li><li>原生扩展（Rust）：将 <code>Radish.Core/test_lib</code> 演示项目抽离为解决方案根目录下的 <code>native/rust/*</code>，编写 <code>cargo build --release</code> + <code>dotnet</code> 构建后拷贝脚本，使共享库自动复制到 <code>Radish.Api</code> 输出目录，后续所有 Rust 扩展统一按该目录结构维护。</li><li>验收： <ul><li><code>dotnet test</code>, <code>npm run test</code>, <code>npm run lint</code>, <code>npm run build</code> 均通过。</li><li>P95 指标满足目标；日志可追踪请求链路。</li><li><code>/api/RustTest/*</code> 在 CI/本地构建后可直接加载 <code>native/rust</code> 输出的 <code>test_lib</code>（DLL/SO/Dylib），无须手动复制。</li></ul></li></ul><h3 id="第-8-周-部署、运维与交付" tabindex="-1">第 8 周｜部署、运维与交付 <a class="header-anchor" href="#第-8-周-部署、运维与交付" aria-label="Permalink to &quot;第 8 周｜部署、运维与交付&quot;">​</a></h3><ul><li>Docker：完善 <code>Radish.Api/Dockerfile</code>（Node/SQLSugar 依赖）与 compose（PostgreSQL + API + 前端静态站点）。</li><li>配置：<code>appsettings.Production.json</code> 模板、环境变量清单、Secret 注入示例。</li><li>文档：补充运维手册、常见问题、回滚策略。</li><li>演示：录制或截图 Compose 一键启动流程。</li><li>验收：<code>docker compose up --build</code> 可直接拉起完整链路；文档指引新人可在 1h 内部署。</li></ul><h2 id="工作项模板-示例" tabindex="-1">工作项模板（示例） <a class="header-anchor" href="#工作项模板-示例" aria-label="Permalink to &quot;工作项模板（示例）&quot;">​</a></h2><p>为方便拆分任务，可沿用以下模板：</p><ul><li><strong>编号</strong>：<code>W{周}-BE/FE/OPS-{序号}</code>，如 <code>W3-BE-2</code> 表示第 3 周后端第 2 项。</li><li><strong>字段</strong>： <ul><li><code>Owner</code>：责任人。</li><li><code>Estimate</code>：预估工作量（0.5d/1d）。</li><li><code>Deps</code>：依赖项（可引用其他任务 ID 或外部条件）。</li><li><code>Checklist</code>：需要完成的细项。</li><li><code>Acceptance</code>：验收标准（日志、截图、接口响应等）。</li><li><code>Deliverables</code>：需要附加到 PR/文档的输出。</li></ul></li></ul><p>示例：</p><div class="language-md vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold;">### W3-BE-1 API 统一异常与日志</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Owner: TBD | Estimate: 1d | Deps: 无</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Checklist:</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 创建 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">`ProblemDetailsExtensions`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">，将业务异常映射为标准响应。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] Serilog LoggingBehavior，写入 traceId、UserId、耗时。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ ] 更新 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">`Radish.Api`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 的中间件顺序，确保异常优先捕获。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Acceptance:</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> `/api/posts/{id}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 人为触发异常时返回 4xx/5xx ProblemDetails。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 日志包含 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">`TraceId`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">`UserId`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">、</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">`ElapsedMs`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">。</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Deliverables:</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 代码 + 单测</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DevelopmentLog 中记录操作步骤。</span></span></code></pre></div><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><ul><li>周度计划可根据实际迭代情况滚动调整，但需在 DevelopmentLog 中记录偏差原因与新目标。</li><li>新增数据库字段或模块时，同步更新迁移脚本与文档（架构/部署/贡献者指南）。</li><li>前端与后端共享的 DTO 请优先在 <code>Radish.Model</code> 中维护，React 侧生成对应的 TypeScript 类型，避免漂移。</li><li>若出现新的关键技术选型（例如引入 redis、消息队列等），请同步更新 DevelopmentFramework 与本文件，保持信息一致。</li><li>React Compiler（实验）：React 19 新编译器暂不在主干启用；待官方正式发布并通过 Vite/Babel 稳定支持后，再在独立分支验证收益（减少手写 memo、优化渲染），评估通过后才会合入主线。</li></ul><h2 id="后续规划-api-gateway" tabindex="-1">后续规划：API Gateway <a class="header-anchor" href="#后续规划-api-gateway" aria-label="Permalink to &quot;后续规划：API Gateway&quot;">​</a></h2><ul><li>详细任务拆解见 <a href="./GatewayPlan.html">GatewayPlan.md</a>，当前阶段专注既有 M1-M8 交付，Gateway 作为 M9 之后的专项迭代。</li><li>触发条件：后端核心用例和认证机制稳定、日志/监控链路可复用。届时启动 P1（项目基线）→ P2（认证）→ P3（路由/聚合）的工作包，并在 DevelopmentLog 记录进度。</li><li>在日常开发中提前预留：规范 Header（<code>X-Request-Id</code>、<code>X-Client-Id</code>）、CORS 配置、登录控制器可被 Gateway 复用，减少后续迁移成本。</li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/docs/DeploymentGuide.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>部署指南</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/docs/DevelopmentLog.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>开发日志</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"authenticationguide.md\":\"Uw5NSHPd\",\"configurationguide.md\":\"Sw0Kb26V\",\"deploymentguide.md\":\"CAFBaCQx\",\"developmentframework.md\":\"nXzUIeHD\",\"developmentlog.md\":\"DlG7OOHi\",\"developmentplan.md\":\"BSNeTUe-\",\"developmentspecifications.md\":\"DtLMyQ61\",\"frontenddesign.md\":\"OT6fA1DJ\",\"gatewayplan.md\":\"QHuMakt9\",\"index.md\":\"RVDAGLzy\",\"openplatformguide.md\":\"BVxeLwOz\",\"readme.md\":\"DSs6HDJd\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Radish 文档\",\"description\":\"Radish 社区平台文档\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"开发文档\",\"link\":\"/DevelopmentSpecifications\"},{\"text\":\"架构设计\",\"link\":\"/DevelopmentFramework\"},{\"text\":\"部署运维\",\"link\":\"/DeploymentGuide\"}],\"sidebar\":{\"/\":[{\"text\":\"快速开始\",\"items\":[{\"text\":\"项目概览\",\"link\":\"/\"}]},{\"text\":\"开发指南\",\"items\":[{\"text\":\"开发规范\",\"link\":\"/DevelopmentSpecifications\"},{\"text\":\"开发框架说明\",\"link\":\"/DevelopmentFramework\"},{\"text\":\"认证与权限\",\"link\":\"/AuthenticationGuide\"},{\"text\":\"前端设计\",\"link\":\"/FrontendDesign\"},{\"text\":\"Gateway 规划\",\"link\":\"/GatewayPlan\"}]},{\"text\":\"部署与运维\",\"items\":[{\"text\":\"部署指南\",\"link\":\"/DeploymentGuide\"},{\"text\":\"开发计划\",\"link\":\"/DevelopmentPlan\"},{\"text\":\"开发日志\",\"link\":\"/DevelopmentLog\"}]}]},\"outline\":\"deep\",\"socialLinks\":[]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>