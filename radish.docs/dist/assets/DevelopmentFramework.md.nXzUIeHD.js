import{_ as o,c as i,o as t,ae as a}from"./chunks/framework.DdJmP4Xu.js";const g=JSON.parse('{"title":"开发整体架构","description":"","frontmatter":{},"headers":[],"relativePath":"DevelopmentFramework.md","filePath":"DevelopmentFramework.md"}'),d={name:"DevelopmentFramework.md"};function l(s,e,n,c,r,p){return t(),i("div",null,[...e[0]||(e[0]=[a(`<h1 id="开发整体架构" tabindex="-1">开发整体架构 <a class="header-anchor" href="#开发整体架构" aria-label="Permalink to &quot;开发整体架构&quot;">​</a></h1><blockquote><p>本文描述 Radish 现阶段的目标模型、技术选型与分层架构，面向参与后端、前端与运维的贡献者。所有内容均基于「.NET 10 + SQLSugar + PostgreSQL + React(Vite)」的新栈，ABP/Angular/MongoDB 方案已归档。</p></blockquote><h2 id="功能期望与范围" tabindex="-1">功能期望与范围 <a class="header-anchor" href="#功能期望与范围" aria-label="Permalink to &quot;功能期望与范围&quot;">​</a></h2><ul><li><p><strong>核心模块</strong></p><ul><li>身份与会话：自建帐号体系、邮箱/用户名登录、JWT + 刷新令牌、角色与权限控制、第三方登录预留。</li><li>门户与文档：Radish.Gateway 提供服务欢迎页面、健康检查展示、API 文档入口；React 单页应用（radish.client）提供业务功能界面；Swagger/Scalar 嵌入至 API 项目。</li><li>内容域：分类 / 标签 / 帖子 / 评论 / 点赞 / 收藏 / 浏览计数，列表分页与过滤，富文本编辑。</li><li>搜索：按标题、标签、分类、作者检索；支持时间/热度排序与模糊匹配（PostgreSQL <code>tsvector</code> 预留）。</li><li>通知与订阅（可选）：帖子互动提醒、积分变动提醒，支持站内信或邮件。</li><li>积分系统：积分账户、积分流水、规则引擎（发帖、互动、被采纳等）。</li><li>商城系统：商品、库存、购买/退款、效果激活（头像框、昵称色、签名等）。</li><li>管理后台（同 React 工程内实现管理视图）：分类、内容、用户、积分与商城配置。</li></ul></li><li><p><strong>非功能性要求</strong></p><ul><li>安全：所有前后端流量强制 HTTPS，登录等敏感参数需在前端使用 RSA 公钥加密后发送，后端持私钥解密；结合 JWT + Refresh、基于角色的授权、CSP/CORS、参数验证与敏感信息集中管控。</li><li>性能：关键查询 P95 ≤ 200ms；SQLSugar Profile + PostgreSQL EXPLAIN 校验索引；读多写少场景可使用内存缓存。</li><li>可用性：健康检查 <code>/health</code>, <code>/ready</code>; SQLSugar 迁移幂等；容器探针。</li><li>可观测性：Serilog 结构化日志、请求跟踪 ID、PostgreSQL 慢查询日志、前端监控埋点。</li><li>国际化：后端资源文件（zh-Hans 基线），前端 i18n（React i18next）。</li><li>质量：后端 xUnit + Shouldly + NSubstitute，前端 Vitest + RTL，关键链路具备 E2E 冒烟。</li><li>配置：<code>appsettings.{Env}.json</code> + 环境变量 + <code>.env</code>；禁止把密钥写入仓库。</li></ul></li><li><p><strong>里程碑（参阅 DevelopmentPlan）</strong></p><ol><li>M1｜基础设施：解决方案构建、PostgreSQL + SQLSugar 通路、健康检查、React 脚手架跑通。</li><li>M2｜领域建模：分类/帖子/评论/用户聚合与仓储、基础 CRUD API。</li><li>M3｜应用服务：权限、DTO、业务编排、错误映射与日志规范。</li><li>M4｜React MVP：认证、导航、列表/详情/发帖链路、态势监测。</li><li>M5｜积分 + 商城：事件驱动积分、商城商品与库存闭环。</li><li>M6｜容器与交付：Dockerfile/Compose、自检脚本、CI 验证。</li></ol></li><li><p><strong>范围外 / 边界</strong></p><ul><li>第三方支付、发票、合规认证（GDPR/等保）。</li><li>大文件转码与 CDN；多端（小程序/Native App）。</li><li>大规模分布式（消息队列、CQRS、多租户），当前阶段聚焦单体 + 水平扩展预留。</li></ul></li></ul><h2 id="技术与架构基线" tabindex="-1">技术与架构基线 <a class="header-anchor" href="#技术与架构基线" aria-label="Permalink to &quot;技术与架构基线&quot;">​</a></h2><table tabindex="0"><thead><tr><th>领域</th><th>选型</th><th>说明</th></tr></thead><tbody><tr><td>语言/运行时</td><td>C# 13, .NET 10</td><td><code>global.json</code> 锁定 SDK 10.0.0，开启 <code>Nullable</code> 与 <code>ImplicitUsings</code></td></tr><tr><td>Web Host</td><td>ASP.NET Core WebApplication</td><td>Program.cs 中最小宿主，按需要拆 Controller/Minimal API</td></tr><tr><td>ORM</td><td><a href="https://github.com/donet5/SqlSugar" target="_blank" rel="noreferrer">SQLSugar</a></td><td>Code First + Migration，仓储层集中管理上下文，支持读写分离配置</td></tr><tr><td>数据库</td><td>PostgreSQL 16</td><td>默认端口 5432，连接通过 <code>ConnectionStrings__Default</code> 注入</td></tr><tr><td>前端</td><td>React 19 + Vite + TypeScript</td><td>Node 24，使用 pnpm/npm 均可；建议 React Query + Zustand/TanStack Router</td></tr><tr><td>前端构建</td><td>Vite Rolldown，ESLint 9，Vitest</td><td>统一在 <code>radish.client</code> 目录运行</td></tr><tr><td>测试</td><td>xUnit 3 + Shouldly + NSubstitute</td><td><code>Radish.Api.Tests</code> 目录；后续可按层拆分</td></tr><tr><td>日志 / 配置</td><td>Serilog + <code>Microsoft.Extensions.Configuration</code></td><td>支持 JSON + 环境变量 + 用户密钥；生产日志输出到 Console + Seq/Elastic 预留</td></tr><tr><td>容器</td><td>Dockerfile（Radish.Api）+ Docker Compose</td><td>Compose 负责 PostgreSQL + API + 前端静态站点</td></tr></tbody></table><h3 id="本地启动脚本" tabindex="-1">本地启动脚本 <a class="header-anchor" href="#本地启动脚本" aria-label="Permalink to &quot;本地启动脚本&quot;">​</a></h3><ul><li><code>local-start.ps1</code>（Windows/PowerShell）与 <code>local-start.sh</code>（Linux/macOS）提供交互式菜单，快速完成常见开发任务。</li><li>Phase 0 完成后将包含六个选项： <ul><li>① 仅启动前端 <code>radish.client</code></li><li>② 仅启动后端 <code>Radish.Api</code>（默认监听 <code>https://localhost:7110</code> 与 <code>http://localhost:5165</code>）</li><li>③ 仅启动 Gateway <code>Radish.Gateway</code>（默认监听 <code>https://localhost:5001</code> 与 <code>http://localhost:5000</code>）</li><li>④ 启动后端 + Gateway</li><li>⑤ 全部启动（前端 + 后端 + Gateway）</li><li>⑥ 执行 <code>Radish.Api.Tests</code> 单元测试</li></ul></li><li>如需自定义配置，可在运行脚本前设置 <code>Configuration</code>（PowerShell 参数）或 <code>CONFIGURATION</code> 环境变量（Shell 脚本）。</li></ul><h3 id="分层视图" tabindex="-1">分层视图 <a class="header-anchor" href="#分层视图" aria-label="Permalink to &quot;分层视图&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>radish.client (React SPA)                    浏览器访问</span></span>
<span class="line"><span>        │ REST/JSON                                │</span></span>
<span class="line"><span>Radish.Api (ASP.NET Core Host)  ←────── Radish.Gateway (Portal &amp; Router)</span></span>
<span class="line"><span>        │ 调用应用服务 + DTO                        │</span></span>
<span class="line"><span>Radish.Service (Application Layer)             │</span></span>
<span class="line"><span>        │ 调度                          服务欢迎页面、健康检查</span></span>
<span class="line"><span>Radish.Core (Domain Layer)                   API 文档入口</span></span>
<span class="line"><span>        │ 抽象 + 领域事件                (P1+: 路由转发、统一认证)</span></span>
<span class="line"><span>Radish.Repository (Infrastructure, SQLSugar)</span></span>
<span class="line"><span>        │ SQL</span></span>
<span class="line"><span>PostgreSQL</span></span></code></pre></div><p><strong>Phase 0 阶段</strong>：Gateway 仅提供门户页面展示，不参与 API 请求转发 <strong>P1+ 阶段</strong>：Gateway 接管所有外部请求，转发至 Radish.Api 和其他服务</p><ul><li><code>Radish.Api</code><ul><li>负责 DI、配置、日志、全局异常、认证授权、Swagger/Scalar、HealthChecks。</li><li>仅保留轻量 Controller/Endpoint，所有核心逻辑委派给 Service 层。</li><li>配置加载：<code>ConfigureAppConfiguration</code> 会先清空默认源，再依次加载 <code>appsettings.json</code> 与 <code>appsettings.{Environment}.json</code>，保证环境差异（连接串、Snowflake、Redis 等）优先由环境文件覆盖，公共默认值仍写在基础文件里兜底。</li><li>雪花 ID：<code>Program</code> 在注册 SqlSugar 之后从 <code>Snowflake</code> 节读取 <code>WorkId</code>、<code>DataCenterId</code> 并写入 <code>SnowFlakeSingle</code>，多实例部署必须在各自的 <code>appsettings.{Env}.json</code> 中配置不同 WorkId；若缺省则读取基础文件的兜底值，禁止把生产与本地设置为同一个编号。</li><li>日志：宿主调用 <code>builder.Host.AddSerilogSetup()</code>，由 <code>Radish.Extension.SerilogExtension</code> 统一配置输出目标。Serilog 默认读取 appsettings，写入控制台与 <code>Log/</code> 目录（普通日志 -&gt; <code>Log.txt</code>，SqlSugar AOP 日志 -&gt; <code>AopSql/AopSql.txt</code>），内部基于 <code>LogContextTool.LogSource</code> 区分日志类型并通过 <code>WriteTo.Async()</code> 异步落盘，避免阻塞请求线程；业务代码默认直接使用 <code>Serilog.Log</code> 静态方法输出日志，仅在依赖外部框架时才注入 <code>ILogger&lt;T&gt;</code>。</li><li>API 文档：开发环境把 Scalar UI 映射到 <code>/api/docs</code>，并通过 <code>builder.Services.AddOpenApi(&quot;v1|v2&quot;)</code> + <code>options.AddDocument(...)</code> 维护多版本；如需定制交互，可在 <code>Radish.Api/wwwroot/scalar/config.js</code> 中追加 JS 配置并在 <code>MapScalarApiReference</code> 中调用 <code>WithJavaScriptConfiguration</code>。</li><li>API 版本控制：采用 <strong>URL 路径版本控制</strong>（<code>/api/v{version}/[controller]/[action]</code>），基于 <code>Asp.Versioning.Mvc</code> (8.1.0) 实现；Controller 通过 <code>[ApiVersion(&quot;x.0&quot;)]</code> 特性声明版本，未指定版本时默认使用 v1.0。v1 包含核心稳定接口（Login、User），v2 包含新功能与实验接口（AppSetting、RustTest）；OpenAPI 文档通过 <code>IApiVersionDescriptionProvider</code> 自动发现所有版本，为每个版本生成独立文档（<code>/openapi/v1.json</code>、<code>/openapi/v2.json</code>），Scalar UI 提供版本下拉菜单，切换时文档自动过滤只显示对应版本的接口。详细规范见 <code>DevelopmentSpecifications.md</code> 的&quot;API 版本控制规范&quot;章节。</li><li>本地调试：<code>Properties/launchSettings.json</code> 提供 <code>http</code>/<code>https</code>（仅启动 API）与 <code>https+spaproxy</code>（同时拉起 <code>radish.client</code> Vite 服务）两种 Profile，可在 VS/<code>dotnet run --launch-profile</code> 间切换作为&quot;联调开关&quot;。</li><li>跨域：<code>appsettings.json</code> 中的 <code>Cors:AllowedOrigins</code> 维护允许访问 API 的前端地址，预设了 <code>localhost:5173</code> 以及 Rolldown 默认端口 <code>58794</code> 的多个别名（<code>vite.dev.localhost</code>、<code>host.*</code> 等）。更换端口或外网域名时记得同步更新该列表。</li></ul></li><li><code>Radish.Gateway</code><ul><li><strong>Phase 0 职责</strong>：承载服务欢迎页面（Razor Pages）、健康检查展示、API 文档入口链接、静态资源服务。</li><li><strong>依赖</strong>：复用 <code>Radish.Common</code>（配置工具）和 <code>Radish.Extension</code>（日志扩展），保持与 <code>Radish.Api</code> 一致的配置加载和日志输出方式。</li><li><strong>监听端口</strong>：<code>https://localhost:5001</code>（主要）和 <code>http://localhost:5000</code>（HTTP 重定向）。</li><li><strong>健康检查</strong>：聚合显示自身和下游 <code>Radish.Api</code> 的健康状态，页面通过 JavaScript 调用下游健康端点实现动态检测。</li><li><strong>架构演进</strong>：Phase 0 为纯静态门户，不引入 Ocelot；P1+ 阶段将增加路由转发、统一认证、请求聚合等 Gateway 核心功能。详见 <code>docs/GatewayPlan.md</code>。</li></ul></li><li>配置与服务访问：Program.cs 依次调用 <code>hostingContext.Configuration.ConfigureApplication()</code> → <code>builder.ConfigureApplication()</code> → <code>app.ConfigureApplication()</code> → <code>app.UseApplicationSetup()</code>，把 Configuration/HostEnvironment/RootServices 注入到 <code>Radish.Common.Core.App</code>；在非 DI 管道下可使用 <code>App.GetService*</code>、<code>App.GetOptions*</code> 手动解析服务或配置。常规字符串读取仍统一使用 <code>AppSettings.RadishApp(&quot;Section&quot;, ...)</code>，批量强类型配置通过 <code>ConfigurableOptions + AddAllOptionRegister</code> 自动绑定 <code>IConfigurableOptions</code>。</li><li><code>Radish.Service</code><ul><li>应用服务（<code>*AppService</code>）封装用例流程、权限校验、事务控制、DTO 转换。</li><li>依赖 <code>Radish.Core</code> 接口与 <code>Radish.Repository</code> 实现，通过 <code>IUnitOfWork</code> 控制 SQLSugar 上下文。</li><li>对外仅返回 DTO/Vo，禁止把 <code>Radish.Model</code> 中的实体直接暴露给 Controller；实体需在此层通过 AutoMapper（一律在 <code>Radish.Extension/AutoMapperSetup</code> 注册）转换为视图模型。</li></ul></li><li><code>Radish.Core</code><ul><li>聚合根（Post、Comment、Category、UserProfile、PointLedger、ShopItem 等）、值对象、领域事件。</li><li>定义仓储接口与领域服务，例如 <code>IPostRepository</code>, <code>IPointPolicyService</code>。</li></ul></li><li><code>Radish.Repository</code><ul><li>持久化实现，集中 SQLSugar 配置（连接池、AOP 日志、软删除、审计字段）。</li><li>提供迁移/种子帮助类，必要时拆分模块级仓储。</li><li>仓储层仅依赖实体类型；返回 Service 层的对象必须是实体或匿名结构，禁止引用 DTO/Vo，保持“实体只存在于仓储层”原则。</li></ul></li><li><code>Radish.Model</code><ul><li>DTO、ViewModel、查询对象、枚举。</li><li>提供 <code>PagedRequest</code>, <code>PagedResponse&lt;T&gt;</code>, <code>ApiError</code> 等复用结构。</li><li>视图模型需以 <code>Vo</code> 开头，并结合业务含义做缩写/扩写（如 <code>VoUsrAudit</code>, <code>VoAssetReport</code>），避免简单加前缀即可猜测真实用途。</li></ul></li><li><code>Radish.Extension</code><ul><li>横切关注：验证、缓存策略、OpenAPI 自定义、JWT 扩展、全局过滤器；按照职责拆分 <code>AutofacExtension/*</code>, <code>AutoMapperExtension/*</code>, <code>RedisExtension/*</code> 等子目录。</li><li><code>RedisExtension.CacheSetup</code> 提供统一入口 <code>AddCacheSetup()</code>，根据 <code>appsettings.json</code> 的 <code>Redis.Enable</code> 自动在 Redis（StackExchange.Redis）与内存缓存间切换，并在启用 Redis 时预先创建 <code>IConnectionMultiplexer</code>；缓存读写统一走 <code>Radish.Common.CacheTool.ICaching</code> 或 <code>IRedisBasketRepository</code>。</li><li><code>SqlSugarExtension.SqlSugarSetup</code> 负责注入 <code>ISqlSugarClient</code> 单例：内部读取 <code>Radish.Common.DbTool.BaseDbConfig</code> 生成的连接集合（含 <code>MainDb</code>、<code>Log</code> 以及所有从库），并在缺失日志库配置时直接抛出异常，确保多库配置在启动阶段即被验证。</li></ul></li><li><code>Radish.Shared</code><ul><li>常量、错误码、事件名、Options 绑定类型。</li></ul></li><li><code>radish.client</code><ul><li>SPA + 内嵌管理视图；共享 DTO 通过 <code>radish.client/src/types</code> 维护，与后端模型保持同步。</li></ul></li><li><code>UserController -&gt; IUserService -&gt; IUserRepository</code> 示例链路 <ul><li>通过内存仓储 + 应用服务演示分层合作，Program.cs 负责注入 <code>IUserService/IUserRepository</code>。</li><li><code>.http</code> 文件与 <code>Radish.Api.Tests/Controllers/UserControllerTest</code> 均以该示例为基准，确保开发者可以快速验证分层约定。</li></ul></li></ul><h3 id="架构示意" tabindex="-1">架构示意 <a class="header-anchor" href="#架构示意" aria-label="Permalink to &quot;架构示意&quot;">​</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Frontend</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        C[React SPA]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Backend</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        A[Radi sh.Server]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        B[Radish.Service]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        D[Radish.Core]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        E[Radish.Repository]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subgraph Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        F[(PostgreSQL)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C -- REST/GraphQL? --&gt; A</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A -- DI 调用 --&gt; B</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B -- 领域接口 --&gt; D</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B -- 仓储接口 --&gt; E</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    E -- SQLSugar --&gt; F</span></span></code></pre></div><h2 id="核心功能模块-mvp" tabindex="-1">核心功能模块（MVP） <a class="header-anchor" href="#核心功能模块-mvp" aria-label="Permalink to &quot;核心功能模块（MVP）&quot;">​</a></h2><table tabindex="0"><thead><tr><th>模块</th><th>后端职责</th><th>前端职责</th></tr></thead><tbody><tr><td>帐号与权限</td><td>用户、角色、权限、JWT/刷新令牌、密码策略、邮箱验证、登录日志</td><td>登录/注册/忘记密码，角色控制菜单，Session 续期提示</td></tr><tr><td>分类/标签</td><td>聚合建模、层级/顺序维护、缓存/快照、只读列表接口</td><td>分类导航、筛选器、管理表单</td></tr><tr><td>帖子/评论</td><td>CRUD、全文搜索预留、交互指标累加、幂等处理</td><td>列表、详情、编辑器、Markdown/富文本、骨架屏</td></tr><tr><td>点赞/收藏</td><td>多表事务（帖子计数 + 用户关系）、幂等 API</td><td>双态按钮、Lazy Update、错误回滚</td></tr><tr><td>积分</td><td>规则配置、事件订阅（发帖、点赞、被采纳）、流水记录、积分账户锁定</td><td>积分面板、历史记录、规则展示</td></tr><tr><td>商城</td><td>商品/库存/价格、购买/退款/激活、权益发放、过期策略</td><td>商品列表/详情、购买流程、权益展示、我的物品</td></tr><tr><td>管理视图</td><td>统一权限守卫、数据导出、批量操作、操作日志</td><td>React Admin Layout、表格与筛选、审计信息</td></tr></tbody></table><h2 id="实时交互-signalr" tabindex="-1">实时交互（SignalR） <a class="header-anchor" href="#实时交互-signalr" aria-label="Permalink to &quot;实时交互（SignalR）&quot;">​</a></h2><ul><li>场景：帖子评论/点赞即时刷新、在线用户状态、积分变化提示、运营公告推送等需要“秒级到达”体验的功能统一通过 SignalR Hub 承载，避免重复造轮子。</li><li>架构：<code>Radish.Api</code> 内新增 <code>Hubs/*Hub.cs</code> 定义 strongly-typed Hub；业务层通过注入 <code>IHubContext&lt;T&gt;</code> 推送消息，或在 Service 内调度事件。客户端由 <code>radish.client</code> 使用 <code>@microsoft/signalr</code> SDK 建立连接，统一封装 <code>useSignalrHub</code> Hook。</li><li>协议：默认使用 JSON over WebSocket，自动降级为 Server-Sent Events/Long Polling；如需 Binary 可切换 MessagePack，需在前后端同时开启。</li><li>安全：连接时附带 JWT/AccessToken，服务端在 <code>OnConnectedAsync</code> 中验证身份与租户；Hub Method 名称使用 PascalCase 并在共享 DTO 中定义负载，禁止随意拼字符串。</li><li>扩展：多实例部署时启用 Redis Backplane（<code>Microsoft.AspNetCore.SignalR.StackExchangeRedis</code>）保持消息一致性；对公网推送需配置 TLS 与速率限制，可在 Nginx/Ingress 层结合 IP 限流。</li></ul><h2 id="数据与持久化策略" tabindex="-1">数据与持久化策略 <a class="header-anchor" href="#数据与持久化策略" aria-label="Permalink to &quot;数据与持久化策略&quot;">​</a></h2><ul><li>SQLSugar 统一由 <code>SqlSugarScope</code> 单例提供，<code>Radish.Common.DbTool.BaseDbConfig.MutiConnectionString</code> 负责解析 <code>appsettings.json</code> 的 <code>MainDb</code> 与 <code>Databases</code> 列表并生成所有连接配置。默认示例包含 <code>Main</code>（业务库）与 <code>Log</code>（日志库）两个 SQLite 文件，可扩展到 PostgreSQL/MySQL 等；若缺少 <code>Log</code> 库会在启动阶段直接抛出异常。</li><li><code>SqlSugarExtension.SqlSugarSetup</code> 会为日志库之外的所有连接注册到 <code>BaseDbConfig.ValidConfig</code>，并将 <code>SqlSugarConst.Log</code> 标记的配置注入日志上下文；SqlSugar 内部缓存通过 <code>SqlSugarCache</code> 委托给现有 <code>ICaching</code>，AOP 事件统一写入 Serilog，便于分析 SQL。</li><li>公共实体基类统一继承 <code>Radish.Model.Root.RootEntityTKey&lt;TKey&gt;</code>，并在派生类中补充审计字段（<code>CreatedAt/By</code>, <code>UpdatedAt/By</code>, <code>IsDeleted</code>, <code>ConcurrencyStamp</code> 等），保证主键类型可控且能被 SqlSugar 的 Attribute 正确识别。</li><li>软删除通过 SQLSugar Filter 全局开启；必要时在仓储层提供 <code>IncludeDeleted</code> 选项。</li><li>迁移策略： <ul><li>开发：<code>db.DbMaintenance.CreateDatabase()</code> + <code>InitTables()</code>。</li><li>生产：通过 <code>Radish.Repository.Migrations</code> 导出 SQL 或在部署阶段运行迁移命令。</li></ul></li><li>数据初始化：<code>SeedRunner</code> 负责创建默认分类、管理员、积分规则。</li><li>PostgreSQL 特性利用：JSONB 列（存储自定义配置）、<code>tsvector</code> 搜索、行级锁（积分/库存扣减）。</li></ul><h2 id="前端架构与规范" tabindex="-1">前端架构与规范 <a class="header-anchor" href="#前端架构与规范" aria-label="Permalink to &quot;前端架构与规范&quot;">​</a></h2><ul><li>详细的前端设计、桌面/移动交互规范与未来 React Native 规划均见 <a href="./FrontendDesign.html">FrontendDesign.md</a>，下文仅保留核心约束。</li><li>Vite 配置 HTTPS、代理 API、环境变量区分（<code>.env.development</code> / <code>.env.production</code>），并在 <code>radish.client</code> 中启用 React 19 + Rolldown。</li><li>目录建议：<code>app/</code>（入口、providers、路由）、<code>features/*</code>（按业务拆包）、<code>widgets/*</code>（桌面组件）、<code>shared/*</code>（api/ui/config），保持与未来 RN 工程一致，方便共享包。</li><li>认证：封装 API 客户端自动附带 Token，失效触发刷新；敏感数据统一通过 RSA 公钥加密。</li><li>状态管理：TanStack Query 管理异步数据与缓存，Zustand 管理 Dock/窗口/主题等客户端状态，表单由 React Hook Form + Zod 验证。</li><li>UI 与可访问性：Tailwind/UnoCSS + 自研组件 + Framer Motion 动效，兼顾键盘/触屏；所有文案走 i18n。</li><li>组件库：计划自研一套基础组件（Button/Input/Select/Checkbox/Radio/Switch/Transfer/Form 等），或在 antd、Arco 等库上做白标二次封装，封装层统一输出 API、主题 Token、交互规范与 Storybook 文档，供桌面/移动/RN 共享。推荐参考 <a href="https://github.com/uiverse-io/galaxy" target="_blank" rel="noreferrer">Uiverse Galaxy</a>（3500+ 社区驱动的开源 UI 组件，支持 CSS/Tailwind，MIT 许可）寻找设计灵感和参考实现。</li><li>桌面化交互规范：桌面 Shell + Dock + 窗口系统为核心体验，移动端自动切换至 Tab/Stack 结构；未来 React Native/Expo 应重用相同的 Design Token 与组件语义。</li><li>测试：组件级 Vitest + React Testing Library，端到端走 Playwright（桌面/移动视口），RN 规划阶段可使用 Detox。</li></ul><h2 id="devops-与运维基线" tabindex="-1">DevOps 与运维基线 <a class="header-anchor" href="#devops-与运维基线" aria-label="Permalink to &quot;DevOps 与运维基线&quot;">​</a></h2><ol><li><strong>配置与密钥</strong>： <ul><li><code>appsettings.json</code> 仅放默认值，环境差异通过 <code>appsettings.{Env}.json</code> + 环境变量。</li><li>本地秘密写入 <code>dotnet user-secrets</code> 或 <code>.env.local</code>（被 .gitignore 忽略）。</li></ul></li><li><strong>日志与监控</strong>： <ul><li>Serilog 写入 Console + File；在容器中输出 JSON 便于收集。</li><li>预留 OpenTelemetry Exporter 与 Prometheus 指标。</li></ul></li><li><strong>部署流水线</strong>： <ul><li>Dockerfile 使用多阶段构建（Restore → Build → Publish）。</li><li>Compose 负责 PostgreSQL + API + 反向代理（如 Caddy/Nginx），可扩展加上前端静态站点。</li><li>生产部署建议挂载 <code>appsettings.Production.json</code> 与证书目录，使用 <code>ConnectionStrings__Default</code> 环境变量。</li></ul></li><li><strong>质量门禁</strong>： <ul><li>PR 必须附带 <code>dotnet test</code> 与 <code>npm run build</code> 结果；若变更数据库需提供迁移脚本与回滚建议。</li><li>关键模块需要 Code Review + Pair Walkthrough。</li></ul></li></ol><h2 id="api-gateway-规划-进行中" tabindex="-1">API Gateway 规划（进行中） <a class="header-anchor" href="#api-gateway-规划-进行中" aria-label="Permalink to &quot;API Gateway 规划（进行中）&quot;">​</a></h2><ul><li><strong>最新决策（2025-11-27）</strong>：Gateway 项目<strong>提前启动</strong>，首要任务是将 <code>Radish.Api</code> 中的服务欢迎页面抽离至独立的 <code>Radish.Gateway</code> 项目（Phase 0）。</li><li><strong>Phase 0 目标</strong>：实现关注点分离，让 API 项目专注于提供接口服务，Gateway 承担服务门户展示职责。Phase 0 阶段不引入 Ocelot，仅实现静态页面展示和健康检查聚合。</li><li><strong>后续阶段（P1-P6）</strong>：在 Phase 0 基础上渐进式引入路由转发、统一认证、请求聚合、服务发现、可观测性、服务拆分等功能。详细规划、任务清单、实施指南见 <a href="./GatewayPlan.html">GatewayPlan.md</a>。</li><li><strong>架构演进路径</strong>：Phase 0（门户页面） → P1（路由转发） → P2（统一认证） → P3（请求聚合） → P4（服务发现） → P5（可观测性） → P6（服务拆分）。</li><li>新增服务/接口仍需在评审阶段勾勒“若未来接入 Gateway 的 URL/Scope/聚合需求”，但不落地任何代码或基础设施。</li></ul><hr><p>如需在架构或选型上做进一步调整，请同步更新本文件并在 DevelopmentLog 中记录决策，确保贡献者获取到一致的信息。</p>`,28)])])}const u=o(d,[["render",l]]);export{g as __pageData,u as default};
