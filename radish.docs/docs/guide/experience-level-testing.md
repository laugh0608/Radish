# 经验值与等级系统测试指南

> 入口页：[经验值与等级系统设计方案](/guide/experience-level-system)

## 1. 排行榜功能测试

### 1.1 测试准备

**启动服务**：
```bash
# 启动后端 API
dotnet run --project Radish.Api

# 启动前端（新终端）
npm run dev --workspace=radish.client
```

**测试数据准备**：
- 确保数据库中有多个用户的经验值数据
- 建议至少有 10+ 个用户，经验值各不相同
- 可以使用管理员接口批量调整用户经验值用于测试

### 1.2 功能测试清单

#### 基础功能
- [ ] 打开 WebOS，点击"排行榜"图标（奖杯图标）
- [ ] 验证排行榜正确显示（按经验值降序）
- [ ] 验证前三名显示金银铜牌样式
- [ ] 验证当前登录用户高亮显示
- [ ] 验证显示内容：排名、用户名、等级、经验值

#### 分页功能
- [ ] 验证分页按钮正常工作
- [ ] 验证"上一页"按钮在第一页时禁用
- [ ] 验证"下一页"按钮在最后一页时禁用
- [ ] 验证页码显示正确（第 X / Y 页）
- [ ] 验证切换页面后排名连续（第2页从51开始）

#### 我的排名
- [ ] 验证顶部显示"我的排名: #X"
- [ ] 验证未登录时不显示我的排名
- [ ] 验证排名计算正确（与实际排行榜位置一致）

#### 边界情况
- [ ] 验证无数据时显示空状态
- [ ] 验证加载中状态显示
- [ ] 验证网络错误时显示错误提示
- [ ] 验证错误后点击"重试"按钮可重新加载

#### 响应式设计
- [ ] 验证桌面端显示正常
- [ ] 验证移动端显示正常（缩小浏览器窗口）
- [ ] 验证各元素在小屏幕上正确适配

### 1.3 API 测试

**测试接口**：
```http
### 获取排行榜（第1页）
GET https://localhost:5000/api/v1/Experience/GetLeaderboard?pageIndex=1&pageSize=50

### 获取排行榜（第2页）
GET https://localhost:5000/api/v1/Experience/GetLeaderboard?pageIndex=2&pageSize=50

### 获取我的排名（需要登录）
GET https://localhost:5000/api/v1/Experience/GetMyRank
Authorization: Bearer {{access_token}}
```

**预期响应**：
```json
{
  "isSuccess": true,
  "statusCode": 200,
  "messageInfo": "查询成功",
  "responseData": {
    "page": 1,
    "pageSize": 50,
    "dataCount": 123,
    "pageCount": 3,
    "data": [
      {
        "rank": 1,
        "userId": "20001",
        "userName": "用户A",
        "currentLevel": 5,
        "currentLevelName": "金丹",
        "totalExp": "50000",
        "themeColor": "#FFC107",
        "isCurrentUser": false
      }
    ]
  }
}
```

### 1.4 性能测试

- [ ] 验证大数据量下（1000+ 用户）排行榜加载速度
- [ ] 验证分页切换响应速度
- [ ] 验证数据库查询性能（查看 SQL 日志）

### 1.5 已知问题

无

---

## 2. 经验值系统完整测试

### 2.1 经验值获取测试

#### 发帖奖励
- [ ] 发布新帖子，验证获得 +20 经验值
- [ ] 首次发帖，验证额外获得 +30 经验值
- [ ] 验证经验值记录在交易列表中

#### 评论奖励
- [ ] 发表评论，验证获得 +5 经验值
- [ ] 首次评论，验证额外获得 +10 经验值

#### 点赞奖励
- [ ] 点赞帖子，验证被点赞者获得 +2 经验值
- [ ] 验证点赞者获得 +1 经验值

#### 神评/沙发奖励
- [ ] 评论被标记为神评，验证获得 +50 经验值
- [ ] 抢到沙发，验证获得 +30 经验值

### 2.2 升级测试

- [ ] 累积经验值达到升级要求
- [ ] 验证升级动画弹窗正确显示
- [ ] 验证显示旧等级 → 新等级
- [ ] 验证显示萝卜币奖励（等级 × 100）
- [ ] 验证自动关闭（5秒后）
- [ ] 验证手动关闭按钮
- [ ] 验证升级通知推送到通知中心

### 2.3 经验条显示测试

#### Dock 经验条
- [ ] 验证 Dock 右侧显示经验条
- [ ] 验证显示当前等级和进度
- [ ] 验证鼠标悬停显示详细信息
- [ ] 验证进度条动画效果

#### 个人主页经验条
- [ ] 打开个人主页
- [ ] 验证头像下方显示经验条
- [ ] 验证显示等级、经验值、进度
- [ ] 验证样式与设计一致

### 2.4 每日上限测试

- [ ] 连续发帖，验证达到每日上限后不再获得经验值
- [ ] 验证第二天重置，可以继续获得经验值
- [ ] 验证不同类型经验值有独立上限

### 2.5 冻结功能测试（管理员）

- [ ] 管理员冻结用户经验值
- [ ] 验证冻结后不再获得经验值
- [ ] 验证冻结用户不出现在排行榜
- [ ] 验证解冻后恢复正常

---

## 3. 集成测试场景

### 场景1：新用户完整流程
1. 注册新用户
2. 首次发帖（+20 + 30 = 50 经验值）
3. 首次评论（+5 + 10 = 15 经验值）
4. 验证总经验值 = 65
5. 验证等级 = Lv.0（凡人）
6. 验证排行榜中出现

### 场景2：升级流程
1. 用户当前经验值 = 95
2. 发布帖子（+20 经验值）
3. 验证升级到 Lv.1（练气）
4. 验证升级动画弹窗
5. 验证获得 100 萝卜币
6. 验证升级通知
7. 验证排行榜排名更新

### 场景3：排行榜竞争
1. 用户A经验值 = 1000
2. 用户B经验值 = 1010
3. 验证用户B排名高于用户A
4. 用户A获得 20 经验值
5. 验证用户A排名超过用户B
6. 验证排行榜实时更新

---

## 4. 压力测试

### 4.1 并发测试
- [ ] 100 个用户同时发帖
- [ ] 验证经验值发放无遗漏
- [ ] 验证乐观锁重试机制正常工作
- [ ] 验证无死锁或超时

### 4.2 大数据量测试
- [ ] 10000+ 用户经验值数据
- [ ] 验证排行榜查询性能
- [ ] 验证排名计算性能
- [ ] 验证数据库索引有效

---

## 5. 测试工具

### 5.1 Postman/REST Client
使用 `Radish.Api/Radish.Api.http` 文件测试 API

### 5.2 浏览器开发者工具
- Network 面板：查看 API 请求和响应
- Console 面板：查看前端日志和错误
- React DevTools：查看组件状态

### 5.3 数据库工具
- 查看 `UserExperience` 表数据
- 查看 `ExpTransaction` 表交易记录
- 查看 `UserExpDailyStats` 表每日统计

---

## 6. 测试报告模板

### 测试环境
- 操作系统：
- 浏览器：
- 后端版本：
- 前端版本：
- 数据库：

### 测试结果
- 测试日期：
- 测试人员：
- 通过项：X / Y
- 失败项：列出失败的测试项
- 阻塞问题：列出阻塞发布的问题
- 建议：改进建议

---

**文档版本**：v1.0
**创建日期**：2026-01-11
**最后更新**：2026-01-11
**维护人员**：开发团队
