# 商城系统设计方案

> 版本：v1.0 | 最后更新：2026-01-12 | 状态：设计中

## 拆分说明

商城系统文档较长，为便于阅读已拆分为多篇文档；章节编号保持不变。

## 文档导航

- [2. 核心概念](/guide/shop-core-concepts) - 商品类型、权益类型、订单状态
- [3. 商品管理](/guide/shop-product) - 商品模型、分类、库存、限购
- [4. 订单系统](/guide/shop-order) - 订单流程、状态机、支付集成
- [5. 权益系统](/guide/shop-inventory) - 用户背包、权益发放、有效期管理
- [6. 后端设计](/guide/shop-backend) - 数据库、Service、API
- [7. 前端设计](/guide/shop-frontend) - 页面、组件、交互
- [8. 实施计划](/guide/shop-roadmap) - 分阶段、验收标准
- [9. 技术完善](/guide/shop-technical-enhancements) - 图片管理、搜索、幂等性、监控

---

## 1. 系统概述

商城系统是 Radish 社区的虚拟物品交易平台，用户可以使用萝卜币购买各类虚拟商品和权益。系统设计遵循"简单易用、安全可靠"的原则，为用户提供流畅的购物体验，同时为社区运营提供灵活的商品管理能力。

### 1.1 核心设计原则

- **简洁性**：购买流程简单直接，减少用户决策成本
- **安全性**：库存并发控制、支付幂等性、防刷机制
- **可扩展性**：商品类型、权益类型可灵活扩展
- **可追溯性**：订单记录完整，权益发放可追踪

### 1.2 业务边界

**本期实现（M9）**：
- ✅ 虚拟商品管理（权益类、消耗品类）
- ✅ 萝卜币支付
- ✅ 订单管理
- ✅ 权益发放与管理
- ✅ 用户背包

**暂不实现**：
- ❌ 实物商品（需要物流系统）
- ❌ 优惠券系统（复杂度较高）
- ❌ 购物车（单品直接购买即可）
- ❌ 退款功能（虚拟商品不支持退款）

### 1.3 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                      商城系统架构                             │
├───────────────────────────────────────────────────────────��─┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    前端展示层                         │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌────────┐  │   │
│  │  │商城首页 │  │商品详情 │  │订单列表 │  │我的背包│  │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    业务服务层                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │ProductService│  │ OrderService │  │InventoryService│ │
│  │  │  商品管理    │  │   订单管理   │  │   权益管理   │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    集成服务层                         │   │
│  │  ┌─────────────┐  ┌���────────────┐  ┌─────────────┐  │   │
│  │  │ CoinService │  │Notification │  │ Experience  │  │   │
│  │  │  萝卜币支付  │  │   消息通知   │  │   经验值    │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                            │                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    数据存储层                         │   │
│  │  Product │ ProductCategory │ Order │ UserInventory   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.4 核心业务流程

```
用户浏览商城
      ↓
选择商品 → 查看详情
      ↓
点击购买 → 确认弹窗
      ↓
      ├── 检查余额 → 余额不足 → 提示充值
      ├── 检查库存 → 库存不足 → 提示售罄
      ├── 检查限购 → 超出限制 → 提示限购
      └── 检查等级 → 等级不足 → 提示升级
      ↓
创建订单 → 扣减萝卜币 → 扣减库存
      ↓
发放权益 → 写入用户背包
      ↓
推送通知 → 购买成功
      ↓
用户可在"我的背包"查看/使用权益
```

### 1.5 与现有系统集成

| 系统 | 集成点 | 说明 |
|------|--------|------|
| 萝卜币系统 | 支付扣款 | 购买商品时扣减萝卜币 |
| 通知系统 | 购买通知 | 购买成功、权益到期提醒 |
| 经验值系统 | 购买奖励 | 购买商品获得经验值（可选） |
| 用户系统 | 等级限购 | 部分商品需要达到特定等级 |

---

## 相关文档

- [萝卜币系统设计](/guide/radish-coin-system) - 支付基础
- [消息通知系统](/guide/notification-realtime) - 通知推送
- [经验值系统](/guide/experience-level-system) - 等级集成
- [开发计划](/development-plan) - M9 里程碑

---

> 本文档随商城系统开发持续更新，如有变更请同步修改 [更新日志](/changelog/)。
