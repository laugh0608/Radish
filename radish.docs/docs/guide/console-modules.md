# Console 功能模块

> 本文档是 [Console 管理后台系统设计方案](/guide/console-system) 的第 3 章

## 3. 功能模块

### 3.1 仪表盘 (Dashboard)

#### 3.1.1 功能概述

仪表盘是管理员登录后的首页，提供系统关键指标的概览和快速导航入口。

#### 3.1.2 核心指标

**用户统计**：
- 总用户数
- 今日新增用户
- 活跃用户数 (日/周/月)
- 在线用户数

**系统状态**：
- API 服务状态 (正常/异常)
- Auth 服务状态
- Gateway 服务状态
- 数据库连接状态
- Redis 连接状态

**业务数据**：
- 今日帖子数
- 今日评论数
- 今日登录次数
- 异常登录次数

**资源使用**：
- CPU 使用率
- 内存使用率
- 磁盘使用率
- 网络流量

#### 3.1.3 快速操作

- 查看最近操作日志 (最近 10 条)
- 查看系统告警 (未处理告警)
- 快速跳转到各功能模块

#### 3.1.4 实现状态

- ✅ 基础页面框架
- 📋 数据统计卡片
- 📋 图表展示 (ECharts)
- 📋 实时数据刷新

---

### 3.2 应用管理 (Applications)

#### 3.2.1 功能概述

管理 OIDC 客户端应用，包括内部应用和第三方应用的注册、配置、密钥管理。

#### 3.2.2 核心功能

**应用列表**：
- 表格展示所有应用
- 支持搜索 (Client ID、显示名称)
- 支持筛选 (类型、状态)
- 支持分页

**新增应用**：
- 填写基本信息 (Client ID、显示名称、描述)
- 配置回调 URI (支持多个)
- 配置登出回调 URI
- 填写开发者信息 (可选)
- 创建成功后显示 Client Secret (仅显示一次)

**编辑应用**：
- 修改显示名称
- 修改描述
- 修改回调 URI
- 修改登出回调 URI
- 注意：Client ID 不可修改

**重置密钥**：
- 二次确认
- 生成新的 Client Secret
- 显示新密钥 (仅显示一次)
- 旧密钥立即失效

**删除应用**：
- 二次确认
- 检查是否有活跃会话
- 删除后不可恢复

**应用详情**：
- 查看完整配置
- 查看使用统计 (登录次数、活跃用户)
- 查看操作日志

#### 3.2.3 数据模型

参考 [核心概念 - OIDC 客户端](/guide/console-core-concepts#_2-4-4-oidc-客户端-oidcclient)

#### 3.2.4 实现状态

- ✅ 应用列表展示
- ✅ 新增应用
- ✅ 编辑应用
- ✅ 重置密钥
- ✅ 删除应用
- 📋 应用详情页
- 📋 使用统计
- 📋 搜索和筛选

---

### 3.3 用户管理 (Users)

#### 3.3.1 功能概述

管理系统用户，包括用户信息维护、状态管理、角色分配。

#### 3.3.2 核心功能

**用户列表**：
- 表格展示所有用户
- 显示：用户名、邮箱、角色、状态、注册时间、最后登录时间
- 支持搜索 (用户名、邮箱、手机号)
- 支持筛选 (角色、状态)
- 支持排序 (注册时间、最后登录时间)
- 支持分页

**用户详情**：
- 基本信息：用户名、邮箱、手机号、头像
- 账号信息：注册时间、最后登录时间、登录次数
- 角色信息：当前角色列表
- 统计信息：帖子数、评论数、萝卜币余额、经验值/等级
- 操作记录：最近操作日志

**用户状态管理**：
- 启用/禁用账号
- 锁定/解锁账号
- 重置密码 (发送重置邮件)
- 强制下线 (清除所有会话)

**角色分配**：
- 查看当前角色
- 添加角色
- 移除角色
- 记录角色变更日志

**批量操作**：
- 批量启用/禁用
- 批量分配角色
- 导出用户列表

#### 3.3.3 权限要求

- `User:Read` - 查看用户列表和详情
- `User:Update` - 修改用户信息
- `User:UpdateStatus` - 修改用户状态
- `Role:Assign` - 分配角色

#### 3.3.4 实现状态

- 📋 用户列表
- 📋 用户详情
- 📋 状态管理
- 📋 角色分配
- 📋 批量操作

---

### 3.4 角色管理 (Roles)

#### 3.4.1 功能概述

管理系统角色和权限，支持自定义角色和权限分配。

#### 3.4.2 核心功能

**角色列表**：
- 表格展示所有角色
- 显示：角色名称、角色代码、权限数量、用户数量、是否系统角色
- 支持搜索 (角色名称、代码)
- 系统角色标记 (不可删除)

**新增角色**：
- 填写角色信息 (代码、名称、描述)
- 选择权限 (树形结构或分组列表)
- 预览权限列表

**编辑角色**：
- 修改角色名称和描述
- 修改权限配置
- 注意：角色代码不可修改

**删除角色**：
- 检查是否有用户使用该角色
- 二次确认
- 系统角色不可删除

**权限管理**：
- 查看所有可用权限
- 按资源分组展示
- 权限说明和示例

**角色详情**：
- 查看完整配置
- 查看使用该角色的用户列表
- 查看操作日志

#### 3.4.3 权限要求

- `Role:Read` - 查看角色列表和详情
- `Role:Create` - 创建角色
- `Role:Update` - 修改角色
- `Role:Delete` - 删除角色

#### 3.4.4 实现状态

- 📋 角色列表
- 📋 新增角色
- 📋 编辑角色
- 📋 删除角色
- 📋 权限管理
- 📋 角色详情

---

### 3.5 系统监控 (System Monitor)

#### 3.5.1 功能概述

实时监控系统运行状态，包括服务健康检查、性能指标、资源使用情况。

#### 3.5.2 核心功能

**服务状态**：
- API 服务健康检查
- Auth 服务健康检查
- Gateway 服务健康检查
- 数据库连接状态
- Redis 连接状态
- 实时状态刷新 (每 30 秒)

**性能指标**：
- API 响应时间 (P50/P95/P99)
- 请求成功率
- 错误率统计
- 并发连接数

**资源使用**：
- CPU 使用率 (实时图表)
- 内存使用率 (实时图表)
- 磁盘使用率
- 网络流量 (入/出)

**日志查询**：
- 按时间范围查询
- 按日志级别筛选 (Debug/Info/Warning/Error)
- 按关键词搜索
- 支持导出

**告警管理**：
- 查看未处理告警
- 告警详情
- 标记已处理
- 告警规则配置

#### 3.5.3 权限要求

- `System:Monitor` - 查看系统监控
- `System:ViewLogs` - 查看日志
- `System:ManageAlerts` - 管理告警

#### 3.5.4 实现状态

- 📋 服务状态监控
- 📋 性能指标展示
- 📋 资源使用图表
- 📋 日志查询
- 📋 告警管理

---

### 3.6 定时任务 (Hangfire)

#### 3.6.1 功能概述

通过 iframe 嵌入 Hangfire Dashboard，管理后台定时任务。

#### 3.6.2 核心功能

- 查看所有定时任务
- 查看任务执行历史
- 手动触发任务
- 查看任务执行日志
- 管理重复任务

#### 3.6.3 实现状态

- ✅ iframe 嵌入 Hangfire Dashboard
- ✅ 通过 Gateway 访问 `/hangfire`

---

### 3.7 操作审计 (Audit Logs)

#### 3.7.1 功能概述

记录和查询管理员的所有操作，确保操作可追溯。

#### 3.7.2 核心功能

**审计日志列表**：
- 表格展示所有操作记录
- 显示：操作时间、操作人、操作类型、资源类型、资源 ID、IP 地址
- 支持时间范围筛选
- 支持操作人筛选
- 支持操作类型筛选
- 支持资源类型筛选
- 支持分页

**日志详情**：
- 查看完整操作详情 (JSON 格式)
- 查看操作前后的数据对比
- 查看 User Agent 和 IP 地址

**日志导出**：
- 按筛选条件导出
- 支持 CSV/Excel 格式
- 支持时间范围限制

#### 3.7.3 记录的操作

- 用户管理：创建、更新、删除、状态变更、角色分配
- 角色管理：创建、更新、删除、权限变更
- 应用管理：创建、更新、删除、密钥重置
- 系统配置：配置变更

#### 3.7.4 权限要求

- `Audit:Read` - 查看审计日志
- `Audit:Export` - 导出审计日志

#### 3.7.5 实现状态

- 📋 审计日志列表
- 📋 日志详情
- 📋 日志导出
- 📋 自动记录机制

---

## 相关文档

- [核心概念](/guide/console-core-concepts) - 权限模型和实体定义
- [技术架构](/guide/console-architecture) - 技术实现细节
- [实施计划](/guide/console-roadmap) - 开发计划
