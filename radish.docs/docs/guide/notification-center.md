# 通知中心使用说明

## 架构定位

通知中心是 Radish WebOS 中的一个**独立应用**，而不是嵌入在 StatusBar 中的组件。

### 访问入口

通知中心提供三个访问入口：

1. **桌面图标**：在桌面上双击"通知中心"图标打开应用窗口
2. **Dock 快捷入口**：在 Dock 展开状态下，点击铃铛图标快速打开通知中心
3. **灵动岛入口**：在灵动岛（Dock 缩小状态）中，点击铃铛图标快速打开通知中心

## 位置与外观

### 桌面图标
- **图标**: `mdi:bell` (铃铛图标)
- **名称**: "通知中心"
- **位置**: 在桌面应用图标网格中显示

### Dock 快捷入口（展开状态）
- **图标**: 白色铃铛图标，位于 Dock 右侧区域
- **未读徽章**: 红色圆点或数字，显示在铃铛右上角
- **位置**: 在时间显示和登录按钮之间

### 灵动岛入口（缩小状态）
- **图标**: 小号铃铛图标，位于灵动岛左侧
- **未读徽章**: 红色小圆点或数字
- **位置**: 在用户头像右侧，应用图标左侧

## 应用窗口

打开通知中心后，会在 WebOS 中显示一个独立窗口：

- **默认尺寸**: 800x700px
- **窗口类型**: 可拖拽、可调整大小的标准窗口
- **背景**: 浅灰色 (#f8f9fa)
- **顶部栏**: 显示"通知中心"标题和未读数统计

## 功能

### 1. 查看通知
- 显示最近 20 条通知
- 每条通知显示：
  - 类型图标（👍点赞、💬评论、⭐收藏等）
  - 标题和内容
  - 触发者头像和名称
  - 相对时间（如"5分钟前"）
  - 未读状态（蓝色左边框）

### 2. 标记已读
- **单条已读**: 点击通知右侧的"标记已读"按钮
- **全部已读**: 点击面板头部的"全部已读"按钮
- 已读通知会移除蓝色边框，未读数量会相应减少

### 3. 删除通知
- 点击通知右侧的"删除"按钮
- 删除后通知会从列表中移除

### 4. 查看更多
- 点击面板底部的"查看全部通知"按钮
- 跳转到完整的通知列表页面（待实现）

## 实时更新
- 当有新通知时，未读数量会自动增加
- 通过 SignalR WebSocket 实现实时推送
- 多端同步：在其他设备标记已读后，当前设备也会同步更新
- 所有访问入口（桌面图标、Dock、灵动岛）的未读数都会同步显示

## 触发通知的操作
以下操作会触发通知：
1. **点赞通知**: 其他用户点赞你的帖子或评论
2. **评论回复**: 其他用户回复你的评论
3. **系统通知**: 系统消息、公告等

## 调试信息
如果通知中心不显示，请检查：
1. 是否已登录（只有登录用户才能看到通知中心）
2. 浏览器控制台是否有错误信息
3. SignalR 连接状态（控制台会显示连接日志）
4. 网络请求是否成功（检查 Network 标签）

## 技术实现

### 组件位置
- **应用组件**: `radish.client/src/apps/notification/NotificationApp.tsx`
- **注册位置**: `radish.client/src/desktop/AppRegistry.tsx`
- **Dock 集成**: `radish.client/src/desktop/Dock.tsx`

### 状态管理
- 使用 `useNotificationStore` 管理通知列表和未读数
- 使用 `useNotificationHub` 管理 SignalR 实时连接
- 通知状态在所有访问入口间共享

### API 集成
- 初始加载：`GET /api/v1/Notification/GetList`
- 标记已读：`POST /api/v1/Notification/MarkAsRead`
- 全部已读：`POST /api/v1/Notification/MarkAllAsRead`
- 删除通知：`DELETE /api/v1/Notification/Delete/{id}`

### SignalR 实时推送
- Hub URL: `/hubs/notification`
- 事件监听：
  - `ReceiveNotification`: 接收新通知
  - `NotificationRead`: 通知已读同步
  - `NotificationDeleted`: 通知删除同步

