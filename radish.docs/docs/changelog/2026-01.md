# 2026年1月开发日志

> 萝卜币系统、消息通知系统、用户等级与经验值、商城系统

本月开发日志已按周分割，请查看：

- [第1周 (1月1日-5日)](./2026-01/week1.md) - Gateway 文档正式化、萝卜币系统 MVP
- [第2周 (1月6日-10日)](./2026-01/week2.md) - 消息通知系统 M7 P1 完成、用户等级与经验值系统 M8 完成
- [第3周 (1月13日-15日)](./2026-01/week3.md) - 商城系统 M9 核心功能完成、里程碑调整

---

## 月度总结

### 核心成果

**萝卜币系统 MVP**（第1周）：
- ✅ 萝卜币基础服务（余额管理、交易记录、系统赠送）
- ✅ 论坛奖励服务（点赞、评论、神评、沙发奖励）
- ✅ 定时任务（神评沙发统计、保留奖励发放）
- ✅ 前端集成（Toast 组件、余额显示、钱包页面）
- ✅ 注册奖励集成（新用户 50 胡萝卜）
- ✅ 精确计算系统（CoinCalculator，52 个单元测试全通过）

**消息通知系统 M7 P1**（第2周）：
- ✅ SignalR Hub 连接和实时推送（P0 完成）
- ✅ 数据模型和独立消息数据库（Radish.Message.db）
- ✅ NotificationService 核心业务逻辑
- ✅ NotificationCacheService 缓存管理
- ✅ NotificationDedupService 去重服务
- ✅ 点赞和评论通知集成
- ✅ 前端通知中心和列表组件
- ✅ API 接口完整（列表、未读数、标记已读、删除）

**用户等级与经验值系统 M8**（第2周）：
- ✅ 11 级修仙体系（凡人→飞升）
- ✅ 经验值发放、等级计算、升级奖励（萝卜币）
- ✅ 乐观锁并发控制（6次重试，指数退避）
- ✅ 每日上限防刷机制（可配置）
- ✅ 经验值计算公式配置化（4种公式）
- ✅ 排行榜功能（分页、排名查询）
- ✅ 经验值详情页面（趋势图、来源饼图、明细列表）
- ✅ 前端完整集成（ExperienceBar、LevelUpModal、Leaderboard、ExperienceDetail）
- ✅ SignalR 实时推送升级通知

**商城系统 M9**（第3周）：
- ✅ P1 阶段：核心购买流程（商品、订单、支付）
- ✅ P2 阶段：权益系统（VIP、徽章、消耗品）
- ✅ P3 阶段：前端页面（商城首页、订单、背包）
- ✅ P4 阶段：管理功能（后端 API 完整）
- ✅ 乐观锁库存控制（防止超卖）
- ✅ 权益时长叠加、消耗品效果框架
- ✅ 通知集成（购买成功推送）
- ✅ 种子数据（5个分类，11个初始商品）

**架构优化**：
- ✅ BaseRepository 泛型聚合方法（QueryDistinctAsync、QuerySumAsync）
- ✅ 开发规范文档精简（CLAUDE.md -66%，节省约 35,000 tokens）
- ✅ 强化分层架构约束（Service 层禁止直接访问 Db 实例）
- ✅ 独立消息数据库架构（性能隔离、架构解耦）

**文档优化**：
- ✅ Gateway 文档从规划转为正式技术文档
- ✅ 消息通知系统文档更新（4个文档，移除过时内容）
- ✅ 商城系统完整设计文档
- ✅ 更新开发计划和日志

**认证功能**：
- ✅ 用户注册功能完善
- ✅ 注册页面视图
- ✅ 安全优化（移除默认测试账号）

**前端体验**：
- ✅ 修复用户头像显示问题
- ✅ 论坛窗口化窄宽时折叠左右分栏
- ✅ Toast 通知组件（@radish/ui）
- ✅ 通知中心应用（独立窗口应用）
- ✅ 商城、订单、背包三个独立应用

### 技术亮点

1. **萝卜币精确计算**：所有交易以整数为单位，统一向下取整，记录舍入差额
2. **消息通知实时推送**：SignalR WebSocket 实时推送，替代轮询机制
3. **通知去重与缓存**：5分钟去重窗口，30分钟缓存过期，提升性能
4. **数据库级聚合**：通过 BaseRepository 泛型方法避免内存过滤，提升性能
5. **独立消息数据库**：通知系统独立数据库，性能隔离和架构解耦
6. **文档质量提升**：基于实际代码实现，包含大量实用示例
7. **乐观锁并发控制**：经验值系统和商城库存均使用乐观锁，防止并发冲突
8. **权益时长叠加**：同类型权益自动延长有效期，用户体验优化

### 里程碑进度

- ✅ M6: 萝卜币系统（2025.12.28~2026.01.03）
- ✅ M7: 消息通知系统 P1（2026.01.10）
- ✅ M8: 用户等级与经验值系统（2026.01.11）
- ✅ M9: 商城系统核心功能（2026.01.13~14）
- 🎯 M10: 后台管理Console（下一步，新增里程碑）

### 里程碑调整（2026-01-15）

**调整说明**：
- M9 商城系统核心功能已完成，剩余优化功能和测试放到最后完成
- M10 调整为后台管理Console项目开发（原商城管理功能移至此实施）
- 原 M10/M11/M12 依次顺延为 M11/M12/M13

**调整优势**：
1. 统一管理界面：所有管理功能在一个 Console 应用中
2. 避免重复工作：不需要分别搭建管理界面
3. 架构清晰：radish.client（用户端）和 radish.console（管理端）职责明确
4. 后端 API 已完成：商城管理 API 已完整实现
5. 不阻塞主线：M9 核心功能已完成，可以开始下一个里程碑

---

查看详细日志请点击上方链接。
