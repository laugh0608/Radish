<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Silent Refresh</title>
  </head>
  <body>
    <script>
      (function () {
        try {
          var query = window.location.search; // e.g. ?code=...&state=...
          var hash = window.location.hash;    // e.g. #id_token=... (implicit)
          var payload = '#';
          if (query && query.length > 1) {
            // Code Flow: angular-oauth2-oidc 需要以“#”开头的片段，并包含查询串
            payload += query.substring(1);
          } else if (hash && hash.length > 1) {
            // 兼容 Implicit/Fragment
            payload += hash.substring(1);
          }
          // 回传给父页面，库会通过 postMessage 读取 customHashFragment
          window.parent.postMessage(payload, window.location.origin);
        } catch (err) {
          // 忽略错误，防止阻塞
        }
      })();
    </script>
  </body>
  </html>

